<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>mixed_models_poisson</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="shortcut icon" href="favicon.ico">

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Heat Stress Research</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Data Preparation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Meteorology Data</li>
    <li>
      <a href="shapefiles.html">Installation Shapefiles</a>
    </li>
    <li>
      <a href="nldas_wget.html">Download NLDAS-2 Data</a>
    </li>
    <li>
      <a href="extract_cells.html">Extract from NLDAS netCDF Files</a>
    </li>
    <li>
      <a href="installation_nldas.html">Tidy NLDAS Data for Analysis</a>
    </li>
    <li>
      <a href="nldas_indices.html">NLDAS Conversions and Indices</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Outcome Data</li>
    <li>
      <a href="dmed_read.html">DMED Queries</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-thermometer"></span>
     
    Meteorology
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="nldas_timeseries.html">Time series formats (zoo, xts, ts)</a>
    </li>
    <li>
      <a href="nldas_fable.html">Time series (Fable)</a>
    </li>
    <li>
      <a href="nldas_averaged.html">Aggregate over calendar periods</a>
    </li>
    <li>
      <a href="climatology.html">Climatologies / Anomalies</a>
    </li>
    <li>
      <a href="annual_tables.html">Annual index tables</a>
    </li>
    <li>
      <a href="af_weather.html">Air Force weather station data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-medkit"></span>
     
    Heat Illness
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Annual</li>
    <li>
      <a href="dmed_summary.html">Annual HSI cases</a>
    </li>
    <li>
      <a href="dmed_full_icd.html">Annual encounters: All ICD codes</a>
    </li>
    <li class="dropdown-header">Daily</li>
    <li class="dropdown-header">Daily cases</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-line-chart"></span>
     
    Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Annual</li>
    <li>
      <a href="dmed_models.html">Annual models - Outpatient HSI</a>
    </li>
    <li>
      <a href="dmed_models_hospitalization.html">Annual models - Inpatient HSI</a>
    </li>
    <li>
      <a href="mixed_models.html">Mixed models</a>
    </li>
    <li>
      <a href="mixed_poisson.html">Mixed models - Poisson</a>
    </li>
    <li class="dropdown-header">Daily</li>
    <li>
      <a href="daily_models.html">Overview of daily models</a>
    </li>
    <li>
      <a href="case_crossover.html">Case-crossover models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-desktop"></span>
     
    Shiny - interactive
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://sal2222.shinyapps.io/annual_heat/">Annual HSI Shiny</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="mailto:sal2222@cumc.columbia.edu">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/sal2222/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">mixed_models_poisson</h1>

</div>


<p>Annual models from DMED data.</p>
<p>Scope:</p>
<p>CONUS Army Installations:</p>
<pre><code>Fort Jackson, SC (Basic Combat Training site)     
Fort Benning, GA (Basic Combat Training site)     
Fort Bragg, NC  
Fort Campbell, KY  
Fort Polk, LA  
Fort Hood, TX  
Fort Stewart, GA  
Fort Leonard Wood, MO (Basic Combat Training site)  
Fort Riley, KS  
Fort Irwin, CA  
Fort Bliss, TX  
  </code></pre>
<p>Population: Active-duty Army service members</p>
<p><strong>Outcome</strong>: Ambulatory (Out-patient), 1997 - 2018 / Hospitalization (In-Patient), 1990-2018 / Reportable Events, 1995 - 2018<br />
Annual Count / Rate of Heat Stress Illness (any type, primary diagnosis)</p>
<p><strong>Exposure indices</strong>:<br />
<em>“Absolute” indices</em><br />
Annual mean (full-year): temperature, heat index, WBGT<br />
Annual heat risk days / hours - Heat index above 80 / 90 / 103 / 125 °F - WBGT above 82 / 85 / 88 / 90 °F</p>
<p><em>“Relative” indices</em> (averaged over full-year and heat season months) Annual mean daily anomaly: temperature, heat index, WBGT<br />
Annual maximum daily anomaly: temperature, heat index, WBGT<br />
Days mean temperature index above daily climate normal percentile (averaged over all hours of day)<br />
- temperature, heat index, WBGT above 85th / 90th / 95th percentiles<br />
Days maximum temperature index above daily climate normal maximum percentile<br />
- temperature, heat index, WBGT above 85th / 90th / 95th percentiles<br />
Days mean temperature index above Standard Deviation(s) of mean daily temperature climate normal<br />
- temperature, heat index, WBGT above 1 or 2 standard deviations of daily normal<br />
Days maximum temperature index above Standard Deviation(s) of max daily temperature climate normal<br />
- temperature, heat index, WBGT above 1 or 2 standard deviations of maximum daily normal</p>
<pre class="r"><code># Outcomes
dmed_tidy &lt;- 
  read_rds(&quot;data/dmed_tidy.rds&quot;)

dmed_tidy</code></pre>
<pre><code>## # A tibble: 11,955 x 9
##    type            category  year count population  rate location strata hsi    
##    &lt;fct&gt;           &lt;fct&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;fct&gt;  
##  1 Ambulatory Data Male      1997     0      6057.     0 jackson  gender hexhsa~
##  2 Ambulatory Data Female    1997     0      2749.     0 jackson  gender hexhsa~
##  3 Ambulatory Data Total     1997     0      8806.     0 jackson  gender hexhsa~
##  4 Hospitalizatio~ Male      1997     0      6057.     0 jackson  gender hexhsa~
##  5 Hospitalizatio~ Female    1997     0      2749.     0 jackson  gender hexhsa~
##  6 Hospitalizatio~ Total     1997     0      8806.     0 jackson  gender hexhsa~
##  7 Reportable Eve~ Male      1997     0      6057.     0 jackson  gender hexhsa~
##  8 Reportable Eve~ Female    1997     0      2749.     0 jackson  gender hexhsa~
##  9 Reportable Eve~ Total     1997     0      8806.     0 jackson  gender hexhsa~
## 10 Ambulatory Data Male      1998     0      6456.     0 jackson  gender hexhsa~
## # ... with 11,945 more rows</code></pre>
<pre class="r"><code># Exposures
annual_tables_list &lt;-
  read_rds(&quot;data/annual_tables_list.rds&quot;)

annual_tables_list</code></pre>
<pre><code>## # A tibble: 25 x 2
## # Groups:   installation [25]
##    installation               data
##    &lt;chr&gt;           &lt;list&lt;df[,31]&gt;&gt;
##  1 eglin_afb             [86 x 31]
##  2 fort_benning_ga       [86 x 31]
##  3 fort_bliss            [86 x 31]
##  4 fort_bragg            [86 x 31]
##  5 fort_campbell         [86 x 31]
##  6 fort_carson           [86 x 31]
##  7 fort_drum             [86 x 31]
##  8 fort_gordon           [86 x 31]
##  9 fort_hood             [86 x 31]
## 10 fort_jackson          [86 x 31]
## # ... with 15 more rows</code></pre>
<pre class="r"><code>index_heat_key &lt;-
  readxl::read_excel(&quot;data/index_heat_key.xlsx&quot;)

index_heat_key</code></pre>
<pre><code>## # A tibble: 84 x 4
##    index        description                                 index_type index_var
##    &lt;chr&gt;        &lt;chr&gt;                                       &lt;chr&gt;      &lt;chr&gt;    
##  1 tmp_f_mean   Annual mean heat index (full calendar year) Absolute   T        
##  2 heat_index_~ Annual mean WBGT (full calendar year)       Absolute   HI       
##  3 wbgt_f_mean  Annual mean temperature (full calendar yea~ Absolute   WBGT     
##  4 tmp_f_max    Maximum temperature during the year         Absolute   T        
##  5 heat_index_~ Maximum heat index during the year          Absolute   HI       
##  6 wbgt_f_max   Maximum WBGT during the year                Absolute   WBGT     
##  7 tmp_f_min    Minimum temperature during the year         Absolute   T        
##  8 heat_index_~ Minimum heat index during the year          Absolute   HI       
##  9 wbgt_f_min   Minimum WBGT during the year                Absolute   WBGT     
## 10 tmp_f_sd     Standard deviation of hourly temperatures ~ Absolute   T        
## # ... with 74 more rows</code></pre>
<pre class="r"><code># write_rds(index_heat_key, &quot;data/index_heat_key.rds&quot;)


index_long &lt;- 
  annual_tables_list %&gt;% 
    filter(installation %in% c(&quot;fort_benning_ga&quot;, &quot;fort_bragg&quot;, &quot;fort_campbell&quot;, &quot;fort_jackson&quot;,
                               &quot;fort_polk&quot;, &quot;fort_hood&quot;, &quot;fort_stewart&quot;, &quot;fort_leonard_wood&quot;, &quot;fort_riley&quot;,
                               &quot;ntc_and_fort_irwin&quot;, &quot;fort_bliss&quot;)) %&gt;% 
    unnest(data) %&gt;% 
    pivot_longer(., cols = `1990`:`2019`, names_to = &quot;year&quot;, values_to = &quot;value&quot;) %&gt;% 
    mutate(year = as.integer(year)) 



# Medical encounters - all ICD codes

all_icd &lt;-
  read_rds(&quot;data/all_icd.rds&quot;) %&gt;% 
  filter(category == &quot;Total&quot;) %&gt;% 
  dplyr::select(-category, -strata, -hsi, -population) %&gt;% 
  dplyr::rename(count_overall = count,
                rate_overall = rate)</code></pre>
<pre class="r"><code>dmed_hsi &lt;-
  dmed_tidy %&gt;% 
    filter(location %in% c(&quot;benning&quot;, &quot;bragg&quot;, &quot;campbell&quot;, &quot;jackson&quot;,
                           &quot;polk&quot;, &quot;hood&quot;, &quot;stewart&quot;, &quot;leonardwood&quot;, 
                           &quot;riley&quot;, &quot;irwin&quot;, &quot;bliss&quot;),
           hsi == &quot;all&quot;,
           strata == &quot;gender&quot;,
           category == &quot;Total&quot;) %&gt;% 
    dplyr::select(-category, -strata, -hsi) %&gt;% 
    dplyr::mutate(location = dplyr::recode(location, jackson = &quot;fort_jackson&quot;),
           location = dplyr::recode(location, benning = &quot;fort_benning_ga&quot;),                 
           location = dplyr::recode(location, bragg = &quot;fort_bragg&quot;),
           location = dplyr::recode(location, campbell = &quot;fort_campbell&quot;),
           location = dplyr::recode(location, polk = &quot;fort_polk&quot;),
           location = dplyr::recode(location, hood = &quot;fort_hood&quot;),
           location = dplyr::recode(location, stewart = &quot;fort_stewart&quot;),
           location = dplyr::recode(location, leonardwood = &quot;fort_leonard_wood&quot;),
           location = dplyr::recode(location, riley = &quot;fort_riley&quot;),
           location = dplyr::recode(location, irwin = &quot;ntc_and_fort_irwin&quot;),
           location = dplyr::recode(location, bliss = &quot;fort_bliss&quot;),
           location = as.character(location)) %&gt;% 
  left_join(all_icd, by = c(&quot;type&quot;, &quot;year&quot;, &quot;location&quot;)) %&gt;% 
  mutate(burden = count/count_overall,
         burden_rate = rate/rate_overall,
         bct = case_when(location %in% c(&quot;fort_benning_ga&quot;, &quot;fort_jackson&quot;, &quot;fort_leonard_wood&quot;) ~ 1,
                         !location %in% c(&quot;fort_benning_ga&quot;, &quot;fort_jackson&quot;, &quot;fort_leonard_wood&quot;) ~ 0)) </code></pre>
<pre><code>## Warning: Column `type` joining factors with different levels, coercing to
## character vector</code></pre>
<pre class="r"><code># Join to indices of heat; center and scale heat index value (pooled, for each index/type - pooled over all included locations and years)  
  
joined_hsi &lt;-
  index_long %&gt;% 
    left_join(dmed_hsi, by = c(&quot;installation&quot; = &quot;location&quot;, &quot;year&quot; = &quot;year&quot;)) %&gt;% 
      drop_na(count) %&gt;% 
  ungroup() %&gt;% 
  dplyr::group_by(index, type) %&gt;% 
      mutate(value_scaled = scale(value, center = TRUE, scale = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  na.omit()

joined_hsi</code></pre>
<pre><code>## # A tibble: 64,764 x 14
##    installation index  year value type  count population  rate count_overall
##    &lt;chr&gt;        &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1 fort_bennin~ tmp_~  1990  68.1 Hosp~     3     18606. 0.161          1022
##  2 fort_bennin~ tmp_~  1991  66.5 Hosp~    14     16067. 0.871          2573
##  3 fort_bennin~ tmp_~  1992  64.7 Hosp~    26     18683. 1.39           2618
##  4 fort_bennin~ tmp_~  1993  65.4 Hosp~    14     19123. 0.732          2845
##  5 fort_bennin~ tmp_~  1994  65.5 Hosp~    22     17948. 1.23           2655
##  6 fort_bennin~ tmp_~  1995  65.7 Repo~    30     16059. 1.87            149
##  7 fort_bennin~ tmp_~  1995  65.7 Hosp~    28     16059. 1.74           2527
##  8 fort_bennin~ tmp_~  1996  64.7 Repo~     6     15459. 0.388            67
##  9 fort_bennin~ tmp_~  1996  64.7 Hosp~     9     15459. 0.582          1896
## 10 fort_bennin~ tmp_~  1997  65.2 Repo~    37     16359. 2.26            257
## # ... with 64,754 more rows, and 5 more variables: rate_overall &lt;dbl&gt;,
## #   burden &lt;dbl&gt;, burden_rate &lt;dbl&gt;, bct &lt;dbl&gt;, value_scaled &lt;dbl&gt;</code></pre>
<pre class="r"><code># write_rds(joined_hsi, &quot;data/joined_hsi.rds&quot;, compress = &quot;none&quot;)</code></pre>
<div id="plots-of-hsi-ambulatory-counts" class="section level2">
<h2>Plots of HSI Ambulatory Counts</h2>
<pre class="r"><code>joined_hsi %&gt;%
  filter(type %in% &quot;Ambulatory Data&quot;) %&gt;% 
  ggplot(aes(x = year, y = population, color = installation, shape = installation)) +
    geom_line() +
    geom_point() +
    labs(
      title = &quot;Population&quot;,
      y = &quot;Population&quot;,
      x = &quot;Year&quot;
    ) +
    scale_shape_manual(values = 0:11) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_ambulatory_rates-1.png" width="672" /></p>
<pre class="r"><code>joined_hsi %&gt;%
  filter(type %in% &quot;Ambulatory Data&quot;) %&gt;% 
  ggplot(aes(x = count)) +
    geom_histogram(color = &quot;darkblue&quot;, fill = &quot;lightblue&quot;) +
    facet_wrap(installation ~ .) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Counts, 1997-2018&quot;,
      y = &quot;Installation&quot;,
      x = &quot;HSI count&quot;
    ) +
    theme_bw() </code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_ambulatory_rates-2.png" width="672" /></p>
<pre class="r"><code># Burden
# 
joined_hsi %&gt;% 
  filter(type %in% &quot;Ambulatory Data&quot;,
         index %in% &quot;tmp_f_mean&quot;) %&gt;% 
  ggplot(aes(x = year, y = burden, color = installation, shape = installation )) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Burden (HSI count/All ICD count)&quot;,
      x = &quot;Year&quot;,
      y = &quot;HSI Burden Ratio&quot;
    ) +
    scale_shape_manual(values = 0:11) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_ambulatory_rates-3.png" width="672" /></p>
</div>
<div id="examine-single-index-of-heat-out-of-80-indices" class="section level2">
<h2>Examine single index of heat (out of 80+ indices)</h2>
<p>Annual hours WBGT greater than 85 deg F</p>
<pre class="r"><code>joined_hsi %&gt;% 
  filter(type %in% &quot;Ambulatory Data&quot;,
         index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
  ggplot(aes(x = year, y = count)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Counts&quot;,
      x = &quot;Year&quot;,
      y = &quot;HSI count&quot;
    ) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>joined_hsi %&gt;% 
  filter(type %in% &quot;Ambulatory Data&quot;,
         index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
  ggplot(aes(x = year, y = count_overall)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Ambulatory Counts - All ICD codes&quot;,
      x = &quot;Year&quot;,
      y = &quot;Count - All diseases and injuries&quot;
    ) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre class="r"><code>joined_hsi %&gt;% 
  filter(type %in% &quot;Hospitalizations&quot;,
         index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
  ggplot(aes(x = year, y = count_overall)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Hospitalization Counts - All ICD codes&quot;,
      x = &quot;Year&quot;,
      y = &quot;Count - All diseases and injuries&quot;
    ) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-3.png" width="672" /></p>
<pre class="r"><code>joined_hsi %&gt;% 
  filter(type %in% &quot;Ambulatory Data&quot;,
         index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
  ggplot(aes(x = year, y = count, color = installation, shape = installation)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Counts&quot;,
      x = &quot;Year&quot;,
      y = &quot;HSI count&quot;
    ) +
    theme_bw() </code></pre>
<pre><code>## Warning: The shape palette can deal with a maximum of 6 discrete values because
## more than 6 becomes difficult to discriminate; you have 11. Consider
## specifying shapes manually if you must have them.</code></pre>
<pre><code>## Warning: Removed 107 rows containing missing values (geom_point).</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-4.png" width="672" /></p>
<pre class="r"><code>joined_hsi %&gt;% 
  filter(type %in% &quot;Ambulatory Data&quot;, 
         index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
  ggplot(aes(x = value, y = count, color = installation, shape = installation)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Counts at 11 Installations (1997-2018)&quot;,
      x = &quot;Hours WBGT &gt; 85 deg F&quot;,
      y = &quot;HSI count&quot;
    ) +
    scale_shape_manual(values = 0:11) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-5.png" width="672" /></p>
<pre class="r"><code>joined_hsi %&gt;% 
  filter(type %in% &quot;Ambulatory Data&quot;, 
         index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
 ggplot(aes(x = value, y = fct_reorder(installation, value))) +
    ggridges::geom_density_ridges(
       jittered_points = TRUE,
       aes(point_color = installation, point_fill = installation), 
       alpha = 0.5,
       point_alpha = 1) +
    labs(
      title = &quot;Hours WBGT exceeding 85 deg F, 1997-2018&quot;,
      y = &quot;Installation&quot;,
      x = &quot;Hours WBGT &gt; 85&quot;
    ) +
    theme_bw() +
    theme(legend.position = &quot;none&quot;)</code></pre>
<pre><code>## Picking joint bandwidth of 29.5</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-6.png" width="672" /></p>
</div>
<div id="observational-findings" class="section level2">
<h2>Observational Findings</h2>
<ol style="list-style-type: decimal">
<li>Ambulatory HSI rates increased over time.</li>
<li>WBGT temperatures increased over time.</li>
<li>Slopes of HSI rate change vary by installation.</li>
<li>Slopes of WBGT increase are consistent by installation (clusters below 100 hours/year and above 200 hours/year).</li>
<li>HSI rates increase with the number of hours of WBGT exceeding 85 deg F.</li>
<li>Slopes of HSI rate increases with hours WBGT &gt; 85 vary by installation (among installations with the highest HSI rates).</li>
</ol>
</div>
<div id="models" class="section level2">
<h2>Models</h2>
<pre class="r"><code># Assign dataset; center and scale predictor value

data_hours_wbgt_gt85_counts &lt;-
  joined_hsi %&gt;% 
  filter(type %in% &quot;Ambulatory Data&quot;,
         index %in% &quot;hours_wbgt_gt85&quot;)</code></pre>
<pre class="r"><code># Fitting ‘installation’ as a fixed effect in model M1 assumes 
# the 11 ‘installation’ means are all independent of one another, 
# and share a common residual variance

pooled &lt;- glm(count ~ value + installation, data = data_hours_wbgt_gt85_counts)
summary(pooled)

pooled_offset &lt;- glm(count ~ value + installation, data = data_hours_wbgt_gt85_counts, offset = log(population))
summary(pooled_offset)


# Fitting installation as a random intercept model in model M2 assumes that the 1 measured
# installation means are only a subset of the realised possibilities drawn from a ‘global’ set of
# population means that follow a Normal distribution with its own mean and variance.

random_intercept &lt;- glmer(count ~ value_scaled + (1|installation), data = data_hours_wbgt_gt85_counts, family = poisson, offset = log(population))

# Fitting random intercepts and slopes allows the slope of a 
# predictor to vary based on a separate grouping variable.

poisson_mod &lt;- glm(count ~ value_scaled + installation, data = data_hours_wbgt_gt85_counts, family = poisson)
sjPlot::tab_model(poisson_mod, p.val = &quot;kr&quot;, show.df = TRUE)

poisson_mod_offset &lt;- glm(count ~ value_scaled + installation, data = data_hours_wbgt_gt85_counts, family = poisson, offset = log(population))
sjPlot::tab_model(poisson_mod, poisson_mod_offset, p.val = &quot;kr&quot;, show.df = TRUE)

random_intercept_slope_no_offset &lt;- glmer(count ~ value_scaled + (1 + value_scaled|installation), data = data_hours_wbgt_gt85_counts, family = poisson)
summary(random_intercept_slope_no_offset)</code></pre>
</div>
<div id="poisson-with-population-offset-mixed-effects-random-intercepts-and-slopes" class="section level2">
<h2>Poisson with population offset, mixed effects (random intercepts and slopes)</h2>
<pre class="r"><code>random_intercept_slope &lt;- glmer(count ~ value_scaled + (1 + value_scaled|installation), data = data_hours_wbgt_gt85_counts, family = poisson, offset = log(population))

summary(random_intercept_slope)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: count ~ value_scaled + (1 + value_scaled | installation)
##    Data: data_hours_wbgt_gt85_counts
##  Offset: log(population)
## 
##      AIC      BIC   logLik deviance df.resid 
##   9993.9  10010.9  -4991.9   9983.9      219 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -20.8301  -2.9190  -0.4014   2.9748  24.7885 
## 
## Random effects:
##  Groups       Name         Variance Std.Dev. Corr
##  installation (Intercept)  0.6662   0.8162       
##               value_scaled 0.1920   0.4381   0.62
## Number of obs: 224, groups:  installation, 11
## 
## Fixed effects:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -5.0431     0.2558 -19.714   &lt;2e-16 ***
## value_scaled   0.4393     0.1526   2.878    0.004 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr)
## value_scald 0.648</code></pre>
<pre class="r"><code>sjPlot::tab_model(random_intercept_slope, p.val = &quot;kr&quot;, show.df = TRUE)</code></pre>
<pre><code>## Warning: mu of 0.0 is too close to zero, estimate of random effect variances may be unreliable.</code></pre>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
count
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Incidence Rate Ratios
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
p
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
(Intercept)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.00 – 0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
value_scaled
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.55
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.15 – 2.09
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>0.004</strong>
</td>
</tr>
<tr>
<td colspan="4" style="font-weight:bold; text-align:left; padding-top:.8em;">
Random Effects
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
σ<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
5.51
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>00</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.67
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>11</sub> <sub>installation.value_scaled</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.19
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ρ<sub>01</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.62
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ICC
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.13
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
N <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
11
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">
224
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
Marginal R<sup>2</sup> / Conditional R<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.027 / 0.153
</td>
</tr>
</table>
<pre class="r"><code>random_intercept_slope_bct &lt;- glmer(count ~ value_scaled + bct + (1 + value_scaled|installation), data = data_hours_wbgt_gt85_counts, family = poisson, offset = log(population))

summary(random_intercept_slope_bct)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: count ~ value_scaled + bct + (1 + value_scaled | installation)
##    Data: data_hours_wbgt_gt85_counts
##  Offset: log(population)
## 
##      AIC      BIC   logLik deviance df.resid 
##   9993.0  10013.5  -4990.5   9981.0      218 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -20.8283  -2.9131  -0.3947   2.9787  24.7624 
## 
## Random effects:
##  Groups       Name         Variance Std.Dev. Corr
##  installation (Intercept)  0.4612   0.6792       
##               value_scaled 0.2062   0.4541   0.56
## Number of obs: 224, groups:  installation, 11
## 
## Fixed effects:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -5.2434     0.2430 -21.581  &lt; 2e-16 ***
## value_scaled   0.4453     0.1574   2.829  0.00468 ** 
## bct            0.7509     0.4175   1.799  0.07205 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) vl_scl
## value_scald  0.531       
## bct         -0.451  0.036</code></pre>
<pre class="r"><code>broom::glance(random_intercept_slope_bct)</code></pre>
<pre><code>## # A tibble: 1 x 6
##   sigma logLik   AIC    BIC deviance df.residual
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;
## 1     1 -4991. 9993. 10013.    8499.         218</code></pre>
<pre class="r"><code>broom::tidy(random_intercept_slope_bct)</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## # A tibble: 6 x 6
##   term                         estimate std.error statistic    p.value group    
##   &lt;chr&gt;                           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    
## 1 (Intercept)                    -5.24      0.243    -21.6   2.72e-103 fixed    
## 2 value_scaled                    0.445     0.157      2.83  4.68e-  3 fixed    
## 3 bct                             0.751     0.417      1.80  7.20e-  2 fixed    
## 4 sd_(Intercept).installation     0.679    NA         NA    NA         installa~
## 5 sd_value_scaled.installation    0.454    NA         NA    NA         installa~
## 6 cor_(Intercept).value_scale~    0.556    NA         NA    NA         installa~</code></pre>
<pre class="r"><code>sjPlot::tab_model(random_intercept_slope_bct, p.val = &quot;kr&quot;, show.df = TRUE)</code></pre>
<pre><code>## Warning: mu of 0.0 is too close to zero, estimate of random effect variances may be unreliable.</code></pre>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
count
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Incidence Rate Ratios
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
p
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
(Intercept)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.00 – 0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
value_scaled
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.56
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.15 – 2.13
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>0.005</strong>
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
bct
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
2.12
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.93 – 4.80
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.072
</td>
</tr>
<tr>
<td colspan="4" style="font-weight:bold; text-align:left; padding-top:.8em;">
Random Effects
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
σ<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
5.51
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>00</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.46
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>11</sub> <sub>installation.value_scaled</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.21
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ρ<sub>01</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.56
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ICC
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.10
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
N <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
11
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">
224
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
Marginal R<sup>2</sup> / Conditional R<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.051 / 0.149
</td>
</tr>
</table>
</div>
<div id="plot-models" class="section level2">
<h2>Plot models</h2>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct)</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-1.png" width="672" /></p>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct, type = &quot;pred&quot;, terms = &quot;value_scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-2.png" width="672" /></p>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct, type = &quot;re&quot;, terms = &quot;value_scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-3.png" width="672" /></p>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct, type = &quot;resid&quot;, terms = &quot;value_scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-4.png" width="672" /></p>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct, type = &quot;diag&quot;, terms = &quot;value_scaled&quot;)</code></pre>
<pre><code>## $installation</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-5.png" width="672" /></p>
</div>
<div id="table-of-index-means-and-standard-deviations-pooled" class="section level2">
<h2>Table of index means and standard deviations (pooled)</h2>
<p>For interpreting centered and scaled estimates.</p>
<pre class="r"><code>index_mean_sd &lt;- 
  joined_hsi %&gt;%
    group_by(index, type) %&gt;% 
    summarise(
      mean = mean(value),
      sd = sd(value)
    )

index_mean_sd</code></pre>
<pre><code>## # A tibble: 252 x 4
## # Groups:   index [84]
##    index                           type               mean    sd
##    &lt;chr&gt;                           &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt;
##  1 days_heat_index_gt85pct         Ambulatory Data   22.9  12.8 
##  2 days_heat_index_gt85pct         Hospitalizations  21.4  12.7 
##  3 days_heat_index_gt85pct         Reportable Events 22.5  12.4 
##  4 days_heat_index_gt85pct_may_sep Ambulatory Data    4.55  5.13
##  5 days_heat_index_gt85pct_may_sep Hospitalizations   4.02  4.91
##  6 days_heat_index_gt85pct_may_sep Reportable Events  4.45  5.01
##  7 days_heat_index_gt90pct         Ambulatory Data   10.7   8.20
##  8 days_heat_index_gt90pct         Hospitalizations   9.88  8.00
##  9 days_heat_index_gt90pct         Reportable Events 10.4   7.99
## 10 days_heat_index_gt90pct_may_sep Ambulatory Data    1.60  2.71
## # ... with 242 more rows</code></pre>
</div>
<div id="multiple-models-function" class="section level2">
<h2>Multiple Models Function</h2>
<pre class="r"><code>random_slope_bct_function = function(df) {
  df %&gt;% 
    glmer(count ~ value_scaled + bct + (1 + value_scaled|installation), data = ., family = poisson, offset = log(population))
}

# Ambulatory nested models

random_slope_bct_nest &lt;-
  joined_hsi %&gt;%
    filter(type %in% &quot;Ambulatory Data&quot;) %&gt;% 
    dplyr::select(index, everything()) %&gt;% 
      nest(data = installation:value_scaled) %&gt;% 
      mutate(glmer_models = map(data, random_slope_bct_function),
             glance = map(glmer_models, broom::glance),
             tidy =   map(glmer_models, broom::tidy),
             augment = map(glmer_models, broom::augment))</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>random_slope_bct_nest </code></pre>
<pre><code>## # A tibble: 84 x 6
##    index                data glmer_models glance      tidy        augment       
##    &lt;chr&gt;       &lt;list&lt;df[,13&gt; &lt;list&gt;       &lt;list&gt;      &lt;list&gt;      &lt;list&gt;        
##  1 tmp_f_mean     [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
##  2 heat_index~    [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
##  3 wbgt_f_mean    [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
##  4 tmp_f_max      [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
##  5 heat_index~    [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
##  6 wbgt_f_max     [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
##  7 tmp_f_min      [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
##  8 heat_index~    [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
##  9 wbgt_f_min     [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
## 10 tmp_f_sd       [224 x 13] &lt;glmerMod&gt;   &lt;tibble [1~ &lt;tibble [6~ &lt;df[,16] [224~
## # ... with 74 more rows</code></pre>
<pre class="r"><code>random_slope_bct_nest$index %&gt;% View()
# Check singular fit models

map(random_slope_bct_nest$glmer_models, isSingular) %&gt;% 
  unlist() %&gt;% 
  tibble::enframe(name = NULL) %&gt;% 
  mutate(index = random_slope_bct_nest$index) %&gt;% 
  filter(value %in% &quot;TRUE&quot;)</code></pre>
<pre><code>## # A tibble: 1 x 2
##   value index                    
##   &lt;lgl&gt; &lt;chr&gt;                    
## 1 TRUE  days_wbgt_gt95pct_may_sep</code></pre>
<pre class="r"><code># Remove `days_wbgt_gt95pct_may_sep`: singular fit model

random_slope_bct_nest &lt;-
  random_slope_bct_nest %&gt;% 
  filter(!index %in% &quot;days_wbgt_gt95pct_may_sep&quot;)


# write_rds(random_slope_bct_nest, &quot;data/random_slope_bct_nest.rds&quot;, compress = &quot;none&quot;)



# Model summaries

# Arranged by magnitude of index value estimate

random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;value_scaled&quot;) %&gt;% 
  arrange(desc(estimate))</code></pre>
<pre><code>## # A tibble: 83 x 7
##    index           term         estimate std.error statistic   p.value group
##    &lt;chr&gt;           &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;
##  1 hours_wbgt_gt82 value_scaled    1.03      0.623      1.65 0.0984    fixed
##  2 heat_index_mean value_scaled    0.723     0.182      3.96 0.0000734 fixed
##  3 tmp_f_mean      value_scaled    0.621     0.180      3.45 0.000562  fixed
##  4 days_hi_gt80    value_scaled    0.570     0.226      2.52 0.0116    fixed
##  5 hours_hi_gt80   value_scaled    0.537     0.188      2.86 0.00428   fixed
##  6 days_wbgt_gt82  value_scaled    0.461     0.157      2.93 0.00344   fixed
##  7 hours_wbgt_gt85 value_scaled    0.445     0.157      2.83 0.00468   fixed
##  8 wbgt_f_mean     value_scaled    0.438     0.181      2.43 0.0152    fixed
##  9 hours_hi_gt90   value_scaled    0.399     0.174      2.29 0.0221    fixed
## 10 days_wbgt_gt85  value_scaled    0.392     0.104      3.79 0.000153  fixed
## # ... with 73 more rows</code></pre>
<pre class="r"><code># Arranged by magnitude of &quot;bct&quot; estimate

random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;bct&quot;) %&gt;% 
  arrange(desc(estimate))</code></pre>
<pre><code>## # A tibble: 83 x 7
##    index                       term  estimate std.error statistic  p.value group
##    &lt;chr&gt;                       &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
##  1 tmp_f_mean                  bct       2.16     0.510      4.23  2.37e-5 fixed
##  2 wbgt_f_mean                 bct       2.12     0.494      4.30  1.74e-5 fixed
##  3 heat_index_mean             bct       2.07     0.622      3.33  8.70e-4 fixed
##  4 heat_index_max_anomaly_mean bct       1.84     0.511      3.61  3.06e-4 fixed
##  5 days_wbgt_max_gt1sd         bct       1.81     0.621      2.91  3.62e-3 fixed
##  6 tmp_f_max_anomaly_mean      bct       1.77     0.503      3.52  4.30e-4 fixed
##  7 heat_index_mean_anomaly_me~ bct       1.72     0.437      3.94  8.21e-5 fixed
##  8 tmp_f_mean_anomaly_mean     bct       1.71     0.440      3.90  9.79e-5 fixed
##  9 days_hi_gt80                bct       1.70     0.518      3.27  1.06e-3 fixed
## 10 heat_index_mean_anomaly_me~ bct       1.63     0.628      2.59  9.60e-3 fixed
## # ... with 73 more rows</code></pre>
<pre class="r"><code># Arranged by AIC (lower is better)

random_slope_bct_nest  %&gt;% 
  unnest(glance, .drop = TRUE) %&gt;% 
  dplyr::select(index, sigma:df.residual) %&gt;% 
  arrange(AIC)</code></pre>
<pre><code>## # A tibble: 83 x 7
##    index                           sigma logLik   AIC   BIC deviance df.residual
##    &lt;chr&gt;                           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;
##  1 heat_index_max_anomaly_mean_ma~     1 -4690. 9392. 9412.    7886.         218
##  2 hours_hi_gt103                      1 -4704. 9420. 9440.    7924.         218
##  3 days_heat_index_max_gt2sd_may_~     1 -4756. 9523. 9544.    8034.         218
##  4 tmp_f_max_anomaly_mean_may_sep      1 -4767. 9546. 9567.    8041.         218
##  5 days_heat_index_max_gt85pct_ma~     1 -4769. 9550. 9570.    8045.         218
##  6 days_tmp_gt85pct_may_sep            1 -4771. 9554. 9574.    8056.         218
##  7 days_heat_index_max_gt1sd_may_~     1 -4780. 9573. 9593.    8066.         218
##  8 hours_hi_gt80                       1 -4782. 9576. 9596.    8072.         218
##  9 days_hi_gt103                       1 -4782. 9577. 9597.    8086.         218
## 10 days_heat_index_max_gt95pct         1 -4795. 9602. 9623.    8103.         218
## # ... with 73 more rows</code></pre>
<pre class="r"><code># Ambulatory estimates plot

random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;value_scaled&quot;) %&gt;%
  mutate(index = fct_reorder(index, estimate)) %&gt;%
  ggplot() +
    geom_point(aes(x = estimate, y = index)) +
    geom_errorbarh(
      aes(y = index,
          xmin = estimate - 1.96 * std.error,
          xmax = estimate + 1.96 * std.error)) +
     geom_vline(aes(xintercept = 0), colour = &quot;blue&quot;) +
     theme_bw() +
     theme(axis.text.y = element_text(size = rel(0.75))) +
      ggtitle(&quot;Regression coefficients - Ambulatory, value-scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code> random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;value_scaled&quot;) %&gt;%
  mutate(index = fct_reorder(index, estimate)) %&gt;% 
  ggplot() +
    geom_point(aes(x = exp(estimate), y = index)) +
    geom_errorbarh(
      aes(y = index,
          xmin = exp(estimate - 1.96 * std.error),
          xmax = exp(estimate + 1.96 * std.error))) +
     geom_vline(aes(xintercept = 1), colour = &quot;blue&quot;) +
     theme_bw() +
     theme(axis.text.y = element_text(size = rel(0.75))) +
     ggtitle(&quot;Rate Ratio - Ambulatory, value-scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<pre class="r"><code># p-value boxplot
random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;value_scaled&quot;) %&gt;% 
  ggplot(aes(x = &quot;&quot;, y = p.value)) +
        geom_boxplot() +
        geom_hline(aes(yintercept = 0.05), colour = &quot;blue&quot;) +
        geom_rug() +
        coord_flip() +
        ggtitle(&quot;Boxplot of value-scaled p-values&quot;) +
        theme_bw()</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
</div>
<div id="plot-estimates-of-all-nested-models" class="section level2">
<h2>Plot estimates of all nested models</h2>
<pre class="r"><code>#random_slope_bct_nest %&gt;% 
#  pull(glmer_models) %&gt;% 
#  map(sjPlot::plot_model)
#  
#

# Plot 10

models_10_names &lt;-
  random_slope_bct_nest  %&gt;% 
      unnest(tidy, .drop = TRUE) %&gt;% 
      dplyr::select(index, term:group) %&gt;%
      filter(term %in% &quot;value_scaled&quot;) %&gt;% 
      arrange(desc(estimate)) %&gt;% 
      slice(1:10) %&gt;%
      pull(index)
           
models_10 &lt;-
  random_slope_bct_nest %&gt;% 
  filter(index %in% models_10_names) %&gt;% 
  pull(glmer_models)

map2(.x = models_10, .y = models_10_names, .f = ~ sjPlot::plot_model(.x, title = .y))  </code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-3.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-4.png" width="672" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-5.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-6.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-7.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-8.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-9.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-10.png" width="672" /></p>
<pre class="r"><code>map2(.x = models_10, .y = models_10_names, .f = ~ sjPlot::plot_model(.x, type = &quot;pred&quot;, terms = &quot;value_scaled&quot;, title = .y))</code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-11.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-12.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-13.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-14.png" width="672" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-15.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-16.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-17.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-18.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-19.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-20.png" width="672" /></p>
<pre class="r"><code>map2(.x = models_10, .y = models_10_names, .f = ~ sjPlot::plot_model(.x, type = &quot;re&quot;, terms = &quot;value_scaled&quot;, title = .y))</code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-21.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-22.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-23.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-24.png" width="672" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-25.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-26.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-27.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-28.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-29.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-30.png" width="672" /></p>
<pre class="r"><code>index_mean_sd %&gt;% 
  filter(index %in% &quot;models_10_names&quot;) %&gt;% 
  knitr::kable(digits = 3) %&gt;% 
  kableExtra::kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
index
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
</tr>
</tbody>
</table>
<pre class="r"><code> random_slope_bct_nest %&gt;% 
  filter(index %in% &quot;hours_wbgt_gt82&quot;) %&gt;% 
  pull(glmer_models) %&gt;%  
  sjPlot::tab_model(p.val = &quot;kr&quot;, show.df = TRUE)</code></pre>
<pre><code>## Warning: mu of 0.0 is too close to zero, estimate of random effect variances may be unreliable.</code></pre>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
count
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Incidence Rate Ratios
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
p
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
(Intercept)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.00 – 0.04
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
value_scaled
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
2.80
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.83 – 9.50
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.098
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
bct
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.49
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.51 – 4.34
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.468
</td>
</tr>
<tr>
<td colspan="4" style="font-weight:bold; text-align:left; padding-top:.8em;">
Random Effects
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
σ<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
5.73
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>00</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
5.47
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>11</sub> <sub>installation.value_scaled</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
4.18
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ρ<sub>01</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.96
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ICC
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.61
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
N <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
11
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">
224
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
Marginal R<sup>2</sup> / Conditional R<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.067 / 0.636
</td>
</tr>
</table>
<pre class="r"><code> random_slope_bct_nest %&gt;% 
  filter(index %in% &quot;hours_wbgt_gt82&quot;) %&gt;% 
  pull(glmer_models) %&gt;%   
summary()</code></pre>
<pre><code>##      Length Class    Mode
## [1,] 1      glmerMod S4</code></pre>
<pre class="r"><code>broom::glance(random_intercept_slope_bct)</code></pre>
<pre><code>## # A tibble: 1 x 6
##   sigma logLik   AIC    BIC deviance df.residual
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;
## 1     1 -4991. 9993. 10013.    8499.         218</code></pre>
<pre class="r"><code>broom::tidy(random_intercept_slope_bct)</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## # A tibble: 6 x 6
##   term                         estimate std.error statistic    p.value group    
##   &lt;chr&gt;                           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    
## 1 (Intercept)                    -5.24      0.243    -21.6   2.72e-103 fixed    
## 2 value_scaled                    0.445     0.157      2.83  4.68e-  3 fixed    
## 3 bct                             0.751     0.417      1.80  7.20e-  2 fixed    
## 4 sd_(Intercept).installation     0.679    NA         NA    NA         installa~
## 5 sd_value_scaled.installation    0.454    NA         NA    NA         installa~
## 6 cor_(Intercept).value_scale~    0.556    NA         NA    NA         installa~</code></pre>
</div>
<div id="hospitalization-nested" class="section level2">
<h2>Hospitalization Nested</h2>
<pre class="r"><code># Hospitalization nested models

hosp_random_slope_bct_nest &lt;-
  joined_hsi %&gt;%
  filter(type %in% &quot;Hospitalizations&quot;) %&gt;% 
  na.omit() %&gt;% 
    dplyr::select(index, everything()) %&gt;% 
      nest(data = installation:value_scaled) %&gt;% 
      mutate(glmer_models = map(data, random_slope_bct_function),
             glance = map(glmer_models, broom::glance),
             tidy =   map(glmer_models, broom::tidy),
             augment = map(glmer_models, broom::augment))</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular
## boundary (singular) fit: see ?isSingular</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.00368588 (tol = 0.001, component 1)</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs

## Warning in hatvalues.merMod(model): the hat matrix may not make sense for GLMMs</code></pre>
<pre class="r"><code># Check singular fit models

map(hosp_random_slope_bct_nest$glmer_models, isSingular) %&gt;% 
  unlist() %&gt;% 
  tibble::enframe(name = NULL) %&gt;% 
  mutate(index = hosp_random_slope_bct_nest$index) %&gt;% 
  filter(value %in% &quot;TRUE&quot;)</code></pre>
<pre><code>## # A tibble: 1 x 2
##   value index      
##   &lt;lgl&gt; &lt;chr&gt;      
## 1 TRUE  wbgt_f_mean</code></pre>
<pre class="r"><code># Remove `days_tmp_gt85pct_may_sep`, `days_tmp_gt95pct_may_sep` , `days_wbgt_gt95pct_may_sep`: singular fit model

hosp_random_slope_bct_nest &lt;-
  hosp_random_slope_bct_nest %&gt;% 
  filter(!index %in% c(&quot;days_wbgt_gt95pct_may_sep&quot;, &quot;days_tmp_gt85pct_may_sep&quot;, &quot;days_tmp_gt95pct_may_sep&quot;))

#write_rds(hosp_random_slope_bct_nest, &quot;data/hosp_random_slope_bct_nest.rds&quot;, compress = &quot;none&quot;)</code></pre>
<pre class="r"><code>hosp_random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;value_scaled&quot;) %&gt;%
  mutate(index = fct_reorder(index, estimate)) %&gt;%
  ggplot() +
    geom_point(aes(x = estimate, y = index)) +
    geom_errorbarh(
      aes(y = index,
          xmin = estimate - 1.96 * std.error,
          xmax = estimate + 1.96 * std.error)) +
     geom_vline(aes(xintercept = 0), colour = &quot;blue&quot;) +
     theme_bw() +
     theme(axis.text.y = element_text(size = rel(0.75))) +
      ggtitle(&quot;Regression coefficients - Hospitalization, value-scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code> hosp_random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;value_scaled&quot;) %&gt;%
  mutate(index = fct_reorder(index, estimate)) %&gt;% 
  ggplot() +
    geom_point(aes(x = exp(estimate), y = index)) +
    geom_errorbarh(
      aes(y = index,
          xmin = exp(estimate - 1.96 * std.error),
          xmax = exp(estimate + 1.96 * std.error))) +
     geom_vline(aes(xintercept = 1), colour = &quot;blue&quot;) +
     theme_bw() +
     theme(axis.text.y = element_text(size = rel(0.75))) +
     ggtitle(&quot;Rate Ratio - Hospitalization, value-scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>mixed_models_poisson</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="shortcut icon" href="favicon.ico">

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Heat Stress Research</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Data Preparation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Meteorology Data</li>
    <li>
      <a href="shapefiles.html">Installation Shapefiles</a>
    </li>
    <li>
      <a href="nldas_wget.html">Download NLDAS-2 Data</a>
    </li>
    <li>
      <a href="extract_cells.html">Extract from NLDAS netCDF Files</a>
    </li>
    <li>
      <a href="installation_nldas.html">Tidy NLDAS Data for Analysis</a>
    </li>
    <li>
      <a href="nldas_indices.html">NLDAS Conversions and Indices</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Outcome Data</li>
    <li>
      <a href="dmed_read.html">DMED Queries</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-thermometer"></span>
     
    Meteorology
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="nldas_timeseries.html">Time series formats (zoo, xts, ts)</a>
    </li>
    <li>
      <a href="nldas_fable.html">Time series (Fable)</a>
    </li>
    <li>
      <a href="nldas_averaged.html">Aggregate over calendar periods</a>
    </li>
    <li>
      <a href="climatology.html">Climatologies / Anomalies</a>
    </li>
    <li>
      <a href="annual_tables.html">Annual index tables</a>
    </li>
    <li>
      <a href="af_weather.html">Air Force weather station data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-medkit"></span>
     
    Heat Illness
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Annual</li>
    <li>
      <a href="dmed_summary.html">Annual cases</a>
    </li>
    <li class="dropdown-header">Daily</li>
    <li class="dropdown-header">Daily cases</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-line-chart"></span>
     
    Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Annual</li>
    <li>
      <a href="dmed_models.html">Annual models - Outpatient HSI</a>
    </li>
    <li>
      <a href="dmed_models_hospitalization.html">Annual models - Inpatient HSI</a>
    </li>
    <li>
      <a href="mixed_models.html">Mixed models</a>
    </li>
    <li>
      <a href="mixed_poisson.html">Mixed models - Poisson</a>
    </li>
    <li class="dropdown-header">Daily</li>
    <li>
      <a href="daily_models.html">Overview of daily models</a>
    </li>
    <li>
      <a href="case_crossover.html">Case-crossover models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-desktop"></span>
     
    Shiny - interactive
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://sal2222.shinyapps.io/annual_heat/">Annual HSI Shiny</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="mailto:sal2222@cumc.columbia.edu">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/sal2222/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">mixed_models_poisson</h1>

</div>


<p>Annual models from DMED data.</p>
<p>Scope:</p>
<p>CONUS Army Installations:</p>
<pre><code>Fort Jackson, SC (Basic Combat Training site)     
Fort Benning, GA (Basic Combat Training site)     
Fort Bragg, NC  
Fort Campbell, KY  
Fort Polk, LA  
Fort Hood, TX  
Fort Stewart, GA  
Fort Leonard Wood, MO (Basic Combat Training site)  
Fort Riley, KS  
Fort Irwin, CA  
Fort Bliss, TX  
  </code></pre>
<p>Population: Active-duty Army service members</p>
<p><strong>Outcome</strong>: Ambulatory (Out-patient), 1997 - 2018 / Hospitalization (In-Patient), 1990-2018 / Reportable Events, 1995 - 2018<br />
Annual Count / Rate of Heat Stress Illness (any type, primary diagnosis)</p>
<p><strong>Exposure indices</strong>:<br />
<em>“Absolute” indices</em><br />
Annual mean (full-year): temperature, heat index, WBGT<br />
Annual heat risk days / hours - Heat index above 80 / 90 / 103 / 125 °F - WBGT above 82 / 85 / 88 / 90 °F</p>
<p><em>“Relative” indices</em> (averaged over full-year and heat season months) Annual mean daily anomaly: temperature, heat index, WBGT<br />
Annual maximum daily anomaly: temperature, heat index, WBGT<br />
Days mean temperature index above daily climate normal percentile (averaged over all hours of day)<br />
- temperature, heat index, WBGT above 85th / 90th / 95th percentiles<br />
Days maximum temperature index above daily climate normal maximum percentile<br />
- temperature, heat index, WBGT above 85th / 90th / 95th percentiles<br />
Days mean temperature index above Standard Deviation(s) of mean daily temperature climate normal<br />
- temperature, heat index, WBGT above 1 or 2 standard deviations of daily normal<br />
Days maximum temperature index above Standard Deviation(s) of max daily temperature climate normal<br />
- temperature, heat index, WBGT above 1 or 2 standard deviations of maximum daily normal</p>
<pre class="r"><code># Outcomes
dmed_tidy &lt;- 
  read_rds(&quot;data/dmed_tidy.rds&quot;)

dmed_tidy</code></pre>
<pre><code>## # A tibble: 11,955 x 9
##    type            category  year count population  rate location strata hsi    
##    &lt;fct&gt;           &lt;fct&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;  &lt;fct&gt;  
##  1 Ambulatory Data Male      1997     0      6057.     0 jackson  gender hexhsa~
##  2 Ambulatory Data Female    1997     0      2749.     0 jackson  gender hexhsa~
##  3 Ambulatory Data Total     1997     0      8806.     0 jackson  gender hexhsa~
##  4 Hospitalizatio~ Male      1997     0      6057.     0 jackson  gender hexhsa~
##  5 Hospitalizatio~ Female    1997     0      2749.     0 jackson  gender hexhsa~
##  6 Hospitalizatio~ Total     1997     0      8806.     0 jackson  gender hexhsa~
##  7 Reportable Eve~ Male      1997     0      6057.     0 jackson  gender hexhsa~
##  8 Reportable Eve~ Female    1997     0      2749.     0 jackson  gender hexhsa~
##  9 Reportable Eve~ Total     1997     0      8806.     0 jackson  gender hexhsa~
## 10 Ambulatory Data Male      1998     0      6456.     0 jackson  gender hexhsa~
## # ... with 11,945 more rows</code></pre>
<pre class="r"><code># Exposures
annual_tables_list &lt;-
  read_rds(&quot;data/annual_tables_list.rds&quot;)

annual_tables_list</code></pre>
<pre><code>## # A tibble: 25 x 2
## # Groups:   installation [25]
##    installation               data
##    &lt;chr&gt;           &lt;list&lt;df[,31]&gt;&gt;
##  1 eglin_afb             [86 x 31]
##  2 fort_benning_ga       [86 x 31]
##  3 fort_bliss            [86 x 31]
##  4 fort_bragg            [86 x 31]
##  5 fort_campbell         [86 x 31]
##  6 fort_carson           [86 x 31]
##  7 fort_drum             [86 x 31]
##  8 fort_gordon           [86 x 31]
##  9 fort_hood             [86 x 31]
## 10 fort_jackson          [86 x 31]
## # ... with 15 more rows</code></pre>
<pre class="r"><code>index_heat_key &lt;-
  readxl::read_excel(&quot;data/index_heat_key.xlsx&quot;)

index_heat_key</code></pre>
<pre><code>## # A tibble: 84 x 4
##    index        description                                 index_type index_var
##    &lt;chr&gt;        &lt;chr&gt;                                       &lt;chr&gt;      &lt;chr&gt;    
##  1 tmp_f_mean   Annual mean heat index (full calendar year) Absolute   T        
##  2 heat_index_~ Annual mean WBGT (full calendar year)       Absolute   HI       
##  3 wbgt_f_mean  Annual mean temperature (full calendar yea~ Absolute   WBGT     
##  4 tmp_f_max    Maximum temperature during the year         Absolute   T        
##  5 heat_index_~ Maximum heat index during the year          Absolute   HI       
##  6 wbgt_f_max   Maximum WBGT during the year                Absolute   WBGT     
##  7 tmp_f_min    Minimum temperature during the year         Absolute   T        
##  8 heat_index_~ Minimum heat index during the year          Absolute   HI       
##  9 wbgt_f_min   Minimum WBGT during the year                Absolute   WBGT     
## 10 tmp_f_sd     Standard deviation of hourly temperatures ~ Absolute   T        
## # ... with 74 more rows</code></pre>
<pre class="r"><code># write_rds(index_heat_key, &quot;data/index_heat_key.rds&quot;)</code></pre>
<pre class="r"><code>dmed_population &lt;-
  dmed_tidy %&gt;% 
  filter(!location %in% c(&quot;us&quot;, &quot;overseas&quot;),
         type == &quot;Ambulatory Data&quot;,
         hsi == &quot;all&quot;,
         strata == &quot;gender&quot;,
         category == &quot;Total&quot;) %&gt;% 
  dplyr::select(location, year, population) %&gt;% 
    mutate(location = dplyr::recode(location, jackson = &quot;fort_jackson&quot;),
           location = dplyr::recode(location, benning = &quot;fort_benning_ga&quot;),                 
           location = dplyr::recode(location, bragg = &quot;fort_bragg&quot;),
           location = dplyr::recode(location, campbell = &quot;fort_campbell&quot;),
           location = dplyr::recode(location, polk = &quot;fort_polk&quot;),
           location = dplyr::recode(location, hood = &quot;fort_hood&quot;),
           location = dplyr::recode(location, stewart = &quot;fort_stewart&quot;),
           location = dplyr::recode(location, leonardwood = &quot;fort_leonard_wood&quot;),
           location = dplyr::recode(location, riley = &quot;fort_riley&quot;),
           location = dplyr::recode(location, irwin = &quot;ntc_and_fort_irwin&quot;),
           location = dplyr::recode(location, bliss = &quot;fort_bliss&quot;),
           location = as.character(location))


index_long &lt;- 
  annual_tables_list %&gt;% 
    filter(installation %in% c(&quot;fort_benning_ga&quot;, &quot;fort_bragg&quot;, &quot;fort_campbell&quot;, &quot;fort_jackson&quot;,
                               &quot;fort_polk&quot;, &quot;fort_hood&quot;, &quot;fort_stewart&quot;, &quot;fort_leonard_wood&quot;, &quot;fort_riley&quot;,
                               &quot;ntc_and_fort_irwin&quot;, &quot;fort_bliss&quot;)) %&gt;% 
    unnest(data) %&gt;% 
    pivot_longer(., cols = `1990`:`2019`, names_to = &quot;year&quot;, values_to = &quot;value&quot;) %&gt;% 
    mutate(year = as.integer(year)) 


hsi_rates &lt;-
  dmed_tidy %&gt;% 
    filter(location %in% c(&quot;benning&quot;, &quot;bragg&quot;, &quot;campbell&quot;, &quot;jackson&quot;,
                           &quot;polk&quot;, &quot;hood&quot;, &quot;stewart&quot;, &quot;leonardwood&quot;, 
                           &quot;riley&quot;, &quot;irwin&quot;, &quot;bliss&quot;),
           type == &quot;Ambulatory Data&quot;,
           hsi == &quot;all&quot;,
           strata == &quot;gender&quot;,
           category == &quot;Total&quot;) %&gt;% 
    dplyr::select(location, year, rate) %&gt;% 
    dplyr::mutate(location = dplyr::recode(location, jackson = &quot;fort_jackson&quot;),
           location = dplyr::recode(location, benning = &quot;fort_benning_ga&quot;),                 
           location = dplyr::recode(location, bragg = &quot;fort_bragg&quot;),
           location = dplyr::recode(location, campbell = &quot;fort_campbell&quot;),
           location = dplyr::recode(location, polk = &quot;fort_polk&quot;),
           location = dplyr::recode(location, hood = &quot;fort_hood&quot;),
           location = dplyr::recode(location, stewart = &quot;fort_stewart&quot;),
           location = dplyr::recode(location, leonardwood = &quot;fort_leonard_wood&quot;),
           location = dplyr::recode(location, riley = &quot;fort_riley&quot;),
           location = dplyr::recode(location, irwin = &quot;ntc_and_fort_irwin&quot;),
           location = dplyr::recode(location, bliss = &quot;fort_bliss&quot;),
           location = as.character(location))

# Ambulatory HSI

hsi_amb &lt;-
  dmed_tidy %&gt;% 
    filter(location %in% c(&quot;benning&quot;, &quot;bragg&quot;, &quot;campbell&quot;, &quot;jackson&quot;,
                           &quot;polk&quot;, &quot;hood&quot;, &quot;stewart&quot;, &quot;leonardwood&quot;, 
                           &quot;riley&quot;, &quot;irwin&quot;, &quot;bliss&quot;),
           type == &quot;Ambulatory Data&quot;,
           hsi == &quot;all&quot;,
           strata == &quot;gender&quot;,
           category == &quot;Total&quot;) %&gt;% 
    dplyr::select(location, year, count, population) %&gt;% 
    dplyr::mutate(location = dplyr::recode(location, jackson = &quot;fort_jackson&quot;),
           location = dplyr::recode(location, benning = &quot;fort_benning_ga&quot;),                 
           location = dplyr::recode(location, bragg = &quot;fort_bragg&quot;),
           location = dplyr::recode(location, campbell = &quot;fort_campbell&quot;),
           location = dplyr::recode(location, polk = &quot;fort_polk&quot;),
           location = dplyr::recode(location, hood = &quot;fort_hood&quot;),
           location = dplyr::recode(location, stewart = &quot;fort_stewart&quot;),
           location = dplyr::recode(location, leonardwood = &quot;fort_leonard_wood&quot;),
           location = dplyr::recode(location, riley = &quot;fort_riley&quot;),
           location = dplyr::recode(location, irwin = &quot;ntc_and_fort_irwin&quot;),
           location = dplyr::recode(location, bliss = &quot;fort_bliss&quot;),
           location = as.character(location),
           rate = (count / population) * 1000)


# Hospitalization HSI

hsi_hosp &lt;-
  dmed_tidy %&gt;% 
    filter(location %in% c(&quot;benning&quot;, &quot;bragg&quot;, &quot;campbell&quot;, &quot;jackson&quot;,
                           &quot;polk&quot;, &quot;hood&quot;, &quot;stewart&quot;, &quot;leonardwood&quot;, 
                           &quot;riley&quot;, &quot;irwin&quot;, &quot;bliss&quot;),
           type == &quot;Hospitalizations&quot;,
           hsi == &quot;all&quot;,
           strata == &quot;gender&quot;,
           category == &quot;Total&quot;) %&gt;% 
    dplyr::select(location, year, count, population) %&gt;% 
    dplyr::mutate(location = dplyr::recode(location, jackson = &quot;fort_jackson&quot;),
           location = dplyr::recode(location, benning = &quot;fort_benning_ga&quot;),                 
           location = dplyr::recode(location, bragg = &quot;fort_bragg&quot;),
           location = dplyr::recode(location, campbell = &quot;fort_campbell&quot;),
           location = dplyr::recode(location, polk = &quot;fort_polk&quot;),
           location = dplyr::recode(location, hood = &quot;fort_hood&quot;),
           location = dplyr::recode(location, stewart = &quot;fort_stewart&quot;),
           location = dplyr::recode(location, leonardwood = &quot;fort_leonard_wood&quot;),
           location = dplyr::recode(location, riley = &quot;fort_riley&quot;),
           location = dplyr::recode(location, irwin = &quot;ntc_and_fort_irwin&quot;),
           location = dplyr::recode(location, bliss = &quot;fort_bliss&quot;),
           location = as.character(location),
           rate = (count / population) * 1000) 



# Reportable Events Counts

hsi_rme &lt;-
  dmed_tidy %&gt;% 
    filter(location %in% c(&quot;benning&quot;, &quot;bragg&quot;, &quot;campbell&quot;, &quot;jackson&quot;,
                           &quot;polk&quot;, &quot;hood&quot;, &quot;stewart&quot;, &quot;leonardwood&quot;, 
                           &quot;riley&quot;, &quot;irwin&quot;, &quot;bliss&quot;),
           type == &quot;Reportable Events&quot;,
           hsi == &quot;all&quot;,
           strata == &quot;gender&quot;,
           category == &quot;Total&quot;) %&gt;% 
    dplyr::select(location, year, count, population) %&gt;% 
    dplyr::mutate(location = dplyr::recode(location, jackson = &quot;fort_jackson&quot;),
           location = dplyr::recode(location, benning = &quot;fort_benning_ga&quot;),                 
           location = dplyr::recode(location, bragg = &quot;fort_bragg&quot;),
           location = dplyr::recode(location, campbell = &quot;fort_campbell&quot;),
           location = dplyr::recode(location, polk = &quot;fort_polk&quot;),
           location = dplyr::recode(location, hood = &quot;fort_hood&quot;),
           location = dplyr::recode(location, stewart = &quot;fort_stewart&quot;),
           location = dplyr::recode(location, leonardwood = &quot;fort_leonard_wood&quot;),
           location = dplyr::recode(location, riley = &quot;fort_riley&quot;),
           location = dplyr::recode(location, irwin = &quot;ntc_and_fort_irwin&quot;),
           location = dplyr::recode(location, bliss = &quot;fort_bliss&quot;),
           location = as.character(location),
           rate = (count / population) * 1000)



# Join with Annual heat; assign Basic Combat Training (BCT) category

# Ambultatory

joined_hsi_amb &lt;-
  index_long %&gt;% 
    left_join(hsi_amb, by = c(&quot;installation&quot; = &quot;location&quot;, &quot;year&quot; = &quot;year&quot;)) %&gt;% 
      drop_na(count) %&gt;% 
  mutate(bct = case_when(installation %in% c(&quot;fort_benning_ga&quot;, &quot;fort_jackson&quot;, &quot;fort_leonard_wood&quot;) ~ 1,
                         !installation %in% c(&quot;fort_benning_ga&quot;, &quot;fort_jackson&quot;, &quot;fort_leonard_wood&quot;) ~ 0))  %&gt;%
  ungroup() %&gt;% 
  dplyr::group_by(index) %&gt;% 
      mutate(value_scaled = scale(value, center = TRUE, scale = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  na.omit()



# Hospitalization
  # Join to indices of heat; assign BCT status; center and scale heat index value (pooled, for each index)  


joined_hsi_hosp &lt;-
  index_long %&gt;% 
    left_join(hsi_hosp, by = c(&quot;installation&quot; = &quot;location&quot;, &quot;year&quot; = &quot;year&quot;)) %&gt;% 
      drop_na(count) %&gt;% 
  mutate(bct = case_when(installation %in% c(&quot;fort_benning_ga&quot;, &quot;fort_jackson&quot;, &quot;fort_leonard_wood&quot;) ~ 1,
                         !installation %in% c(&quot;fort_benning_ga&quot;, &quot;fort_jackson&quot;, &quot;fort_leonard_wood&quot;) ~ 0)) %&gt;%
  ungroup() %&gt;% 
  dplyr::group_by(index) %&gt;% 
      mutate(value_scaled = scale(value, center = TRUE, scale = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  na.omit()

# write_rds(joined_hsi_hosp, &quot;data/joined_hsi_hosp.rds&quot;, compress = &quot;none&quot;)



# Reportable Events
joined_hsi_rme &lt;-
  index_long %&gt;% 
    left_join(hsi_rme, by = c(&quot;installation&quot; = &quot;location&quot;, &quot;year&quot; = &quot;year&quot;)) %&gt;% 
      drop_na(count) %&gt;% 
  mutate(bct = case_when(installation %in% c(&quot;fort_benning_ga&quot;, &quot;fort_jackson&quot;, &quot;fort_leonard_wood&quot;) ~ 1,
                         !installation %in% c(&quot;fort_benning_ga&quot;, &quot;fort_jackson&quot;, &quot;fort_leonard_wood&quot;) ~ 0)) %&gt;%
  ungroup() %&gt;% 
  dplyr::group_by(index) %&gt;% 
      mutate(value_scaled = scale(value, center = TRUE, scale = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  na.omit()

# write_rds(joined_hsi_rme, &quot;data/joined_hsi_rme.rds&quot;, compress = &quot;none&quot;)</code></pre>
<div id="plots-of-hsi-ambulatory-counts" class="section level2">
<h2>Plots of HSI Ambulatory Counts</h2>
<pre class="r"><code>joined_hsi_amb %&gt;% 
 ggplot(aes(x = year, y = population, color = installation, shape = installation)) +
    geom_line() +
    geom_point() +
    labs(
      title = &quot;Population&quot;,
      y = &quot;Population&quot;,
      x = &quot;Year&quot;
    ) +
    scale_shape_manual(values = 0:11) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_ambulatory_rates-1.png" width="672" /></p>
<pre class="r"><code>joined_hsi_amb %&gt;% 
 ggplot(aes(x = count)) +
    geom_histogram(color = &quot;darkblue&quot;, fill = &quot;lightblue&quot;) +
    facet_wrap(installation ~ .) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Counts, 1997-2018&quot;,
      y = &quot;Installation&quot;,
      x = &quot;HSI count&quot;
    ) +
    theme_bw() </code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_ambulatory_rates-2.png" width="672" /></p>
</div>
<div id="examine-single-index-of-heat-out-of-80-indices" class="section level2">
<h2>Examine single index of heat (out of 80+ indices)</h2>
<p>Annual hours WBGT greater than 85 deg F</p>
<pre class="r"><code>joined_hsi_amb %&gt;% 
  filter(index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
  ggplot(aes(x = year, y = count)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Counts&quot;,
      x = &quot;Year&quot;,
      y = &quot;HSI count&quot;
    ) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>joined_hsi_amb %&gt;% 
  filter(index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
  ggplot(aes(x = year, y = count, color = installation, shape = installation)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Counts&quot;,
      x = &quot;Year&quot;,
      y = &quot;HSI count&quot;
    ) +
    theme_bw() </code></pre>
<pre><code>## Warning: The shape palette can deal with a maximum of 6 discrete values because
## more than 6 becomes difficult to discriminate; you have 11. Consider
## specifying shapes manually if you must have them.</code></pre>
<pre><code>## Warning: Removed 110 rows containing missing values (geom_point).</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre class="r"><code>joined_hsi_amb %&gt;% 
  filter(index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
  ggplot(aes(x = value, y = count, color = installation, shape = installation)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE, size = 0.8) +
    labs(
      title = &quot;Army Heat Stress Illness Ambulatory Counts at 11 Installations (1997-2018)&quot;,
      x = &quot;Hours WBGT &gt; 85 deg F&quot;,
      y = &quot;HSI count&quot;
    ) +
    scale_shape_manual(values = 0:11) +
    theme_bw() </code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-3.png" width="672" /></p>
<pre class="r"><code>joined_hsi_amb %&gt;% 
   filter(index %in% &quot;hours_wbgt_gt85&quot;) %&gt;% 
 ggplot(aes(x = value, y = fct_reorder(installation, value))) +
    ggridges::geom_density_ridges(
       jittered_points = TRUE,
       aes(point_color = installation, point_fill = installation), 
       alpha = 0.5,
       point_alpha = 1) +
    labs(
      title = &quot;Hours WBGT exceeding 85 deg F, 1997-2018&quot;,
      y = &quot;Installation&quot;,
      x = &quot;Hours WBGT &gt; 85&quot;
    ) +
    theme_bw() +
    theme(legend.position = &quot;none&quot;)</code></pre>
<pre><code>## Picking joint bandwidth of 31.8</code></pre>
<p><img src="mixed_poisson_files/figure-html/unnamed-chunk-1-4.png" width="672" /></p>
</div>
<div id="observational-findings" class="section level2">
<h2>Observational Findings</h2>
<ol style="list-style-type: decimal">
<li>Ambulatory HSI rates increased over time.</li>
<li>WBGT temperatures increased over time.</li>
<li>Slopes of HSI rate change vary by installation.</li>
<li>Slopes of WBGT increase are consistent by installation (clusters below 100 hours/year and above 200 hours/year).</li>
<li>HSI rates increase with the number of hours of WBGT exceeding 85 deg F.</li>
<li>Slopes of HSI rate increases with hours WBGT &gt; 85 vary by installation (among installations with the highest HSI rates).</li>
</ol>
</div>
<div id="models" class="section level2">
<h2>Models</h2>
<pre class="r"><code># Assign dataset; center and scale predictor value

data_hours_wbgt_gt85_counts &lt;-
  joined_hsi_amb %&gt;% 
    filter(index %in% &quot;hours_wbgt_gt85&quot;)</code></pre>
<pre class="r"><code># Fitting ‘installation’ as a fixed effect in model M1 assumes 
# the 11 ‘installation’ means are all independent of one another, 
# and share a common residual variance

pooled &lt;- glm(count ~ value + installation, data = data_hours_wbgt_gt85_counts)
summary(pooled)

pooled_offset &lt;- glm(count ~ value + installation, data = data_hours_wbgt_gt85_counts, offset = log(population))
summary(pooled_offset)


# Fitting installation as a random intercept model in model M2 assumes that the 1 measured
# installation means are only a subset of the realised possibilities drawn from a ‘global’ set of
# population means that follow a Normal distribution with its own mean and variance.

random_intercept &lt;- glmer(count ~ value_scaled + (1|installation), data = data_hours_wbgt_gt85_counts, family = poisson, offset = log(population))

# Fitting random intercepts and slopes allows the slope of a 
# predictor to vary based on a separate grouping variable.

poisson_mod &lt;- glm(count ~ value_scaled + installation, data = data_hours_wbgt_gt85_counts, family = poisson)
sjPlot::tab_model(poisson_mod, p.val = &quot;kr&quot;, show.df = TRUE)

poisson_mod_offset &lt;- glm(count ~ value_scaled + installation, data = data_hours_wbgt_gt85_counts, family = poisson, offset = log(population))
sjPlot::tab_model(poisson_mod, poisson_mod_offset, p.val = &quot;kr&quot;, show.df = TRUE)

random_intercept_slope_no_offset &lt;- glmer(count ~ value_scaled + (1 + value_scaled|installation), data = data_hours_wbgt_gt85_counts, family = poisson)
summary(random_intercept_slope_no_offset)</code></pre>
</div>
<div id="poisson-with-population-offset-mixed-effects-random-intercepts-and-slopes" class="section level2">
<h2>Poisson with population offset, mixed effects (random intercepts and slopes)</h2>
<pre class="r"><code>random_intercept_slope &lt;- glmer(count ~ value_scaled + (1 + value_scaled|installation), data = data_hours_wbgt_gt85_counts, family = poisson, offset = log(population))

summary(random_intercept_slope)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: count ~ value_scaled + (1 + value_scaled | installation)
##    Data: data_hours_wbgt_gt85_counts
##  Offset: log(population)
## 
##      AIC      BIC   logLik deviance df.resid 
##  13324.9  13342.4  -6657.5  13314.9      237 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -20.8749  -3.4961  -0.6351   3.0096  29.6322 
## 
## Random effects:
##  Groups       Name         Variance Std.Dev. Corr
##  installation (Intercept)  0.9081   0.9529       
##               value_scaled 0.2928   0.5411   0.71
## Number of obs: 242, groups:  installation, 11
## 
## Fixed effects:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -4.8636     0.2976 -16.344  &lt; 2e-16 ***
## value_scaled   0.5932     0.1835   3.233  0.00122 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr)
## value_scald 0.722</code></pre>
<pre class="r"><code>sjPlot::tab_model(random_intercept_slope, p.val = &quot;kr&quot;, show.df = TRUE)</code></pre>
<pre><code>## Warning: mu of 0.0 is too close to zero, estimate of random effect variances may be unreliable.</code></pre>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
count
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Incidence Rate Ratios
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
p
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
(Intercept)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.00 – 0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
value_scaled
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.81
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.26 – 2.59
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>0.001</strong>
</td>
</tr>
<tr>
<td colspan="4" style="font-weight:bold; text-align:left; padding-top:.8em;">
Random Effects
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
σ<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
5.57
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>00</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.91
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>11</sub> <sub>installation.value_scaled</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.29
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ρ<sub>01</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.71
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ICC
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.18
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
N <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
11
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">
242
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
Marginal R<sup>2</sup> / Conditional R<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.049 / 0.218
</td>
</tr>
</table>
<pre class="r"><code>random_intercept_slope_bct &lt;- glmer(count ~ value_scaled + bct + (1 + value_scaled|installation), data = data_hours_wbgt_gt85_counts, family = poisson, offset = log(population))

summary(random_intercept_slope_bct)</code></pre>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: count ~ value_scaled + bct + (1 + value_scaled | installation)
##    Data: data_hours_wbgt_gt85_counts
##  Offset: log(population)
## 
##      AIC      BIC   logLik deviance df.resid 
##  13324.1  13345.1  -6656.1  13312.1      236 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -20.8725  -3.4952  -0.6261   3.0073  29.6230 
## 
## Random effects:
##  Groups       Name         Variance Std.Dev. Corr
##  installation (Intercept)  0.7030   0.8385       
##               value_scaled 0.2912   0.5396   0.70
## Number of obs: 242, groups:  installation, 11
## 
## Fixed effects:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -5.0670     0.2875 -17.624  &lt; 2e-16 ***
## value_scaled   0.5928     0.1834   3.232  0.00123 ** 
## bct            0.7413     0.4180   1.773  0.07616 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##             (Intr) vl_scl
## value_scald  0.663       
## bct         -0.391  0.016</code></pre>
<pre class="r"><code>broom::glance(random_intercept_slope_bct)</code></pre>
<pre><code>## # A tibble: 1 x 6
##   sigma logLik    AIC    BIC deviance df.residual
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;
## 1     1 -6656. 13324. 13345.   11683.         236</code></pre>
<pre class="r"><code>broom::tidy(random_intercept_slope_bct)</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding factor and character vector, coercing
## into character vector</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector, coercing
## into character vector</code></pre>
<pre><code>## # A tibble: 6 x 6
##   term                          estimate std.error statistic   p.value group    
##   &lt;chr&gt;                            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    
## 1 (Intercept)                     -5.07      0.288    -17.6   1.62e-69 fixed    
## 2 value_scaled                     0.593     0.183      3.23  1.23e- 3 fixed    
## 3 bct                              0.741     0.418      1.77  7.62e- 2 fixed    
## 4 sd_(Intercept).installation      0.838    NA         NA    NA        installa~
## 5 sd_value_scaled.installation     0.540    NA         NA    NA        installa~
## 6 cor_(Intercept).value_scaled~    0.702    NA         NA    NA        installa~</code></pre>
<pre class="r"><code>sjPlot::tab_model(random_intercept_slope_bct, p.val = &quot;kr&quot;, show.df = TRUE)</code></pre>
<pre><code>## Warning: mu of 0.0 is too close to zero, estimate of random effect variances may be unreliable.</code></pre>
<table style="border-collapse:collapse; border:none;">
<tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">
 
</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">
count
</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">
Predictors
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
Incidence Rate Ratios
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
CI
</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">
p
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
(Intercept)
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.00 – 0.01
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>&lt;0.001
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
value_scaled
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.81
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
1.26 – 2.59
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
<strong>0.001</strong>
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">
bct
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
2.10
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.92 – 4.76
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">
0.076
</td>
</tr>
<tr>
<td colspan="4" style="font-weight:bold; text-align:left; padding-top:.8em;">
Random Effects
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
σ<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
5.57
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>00</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.70
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
τ<sub>11</sub> <sub>installation.value_scaled</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.29
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ρ<sub>01</sub> <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.70
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
ICC
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.15
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
N <sub>installation</sub>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
11
</td>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">
Observations
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">
242
</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">
Marginal R<sup>2</sup> / Conditional R<sup>2</sup>
</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">
0.074 / 0.214
</td>
</tr>
</table>
</div>
<div id="plot-models" class="section level2">
<h2>Plot models</h2>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct)</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-1.png" width="672" /></p>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct, type = &quot;pred&quot;, terms = &quot;value_scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-2.png" width="672" /></p>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct, type = &quot;re&quot;, terms = &quot;value_scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-3.png" width="672" /></p>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct, type = &quot;resid&quot;, terms = &quot;value_scaled&quot;)</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-4.png" width="672" /></p>
<pre class="r"><code>sjPlot::plot_model(random_intercept_slope_bct, type = &quot;diag&quot;, terms = &quot;value_scaled&quot;)</code></pre>
<pre><code>## $installation</code></pre>
<p><img src="mixed_poisson_files/figure-html/model_plots-5.png" width="672" /></p>
</div>
<div id="table-of-index-means-and-standard-deviations-pooled" class="section level2">
<h2>Table of index means and standard deviations (pooled)</h2>
<p>For interpreting centered and scaled estimates.</p>
<pre class="r"><code>index_mean_sd &lt;- 
  joined_hsi_amb %&gt;% 
    group_by(index) %&gt;% 
    summarise(
      mean = mean(value),
      sd = sd(value)
    )

index_mean_sd</code></pre>
<pre><code>## # A tibble: 84 x 3
##    index                               mean     sd
##    &lt;chr&gt;                              &lt;dbl&gt;  &lt;dbl&gt;
##  1 days_heat_index_gt85pct           23.5   12.8  
##  2 days_heat_index_gt85pct_may_sep    4.53   5.11 
##  3 days_heat_index_gt90pct           11.0    8.19 
##  4 days_heat_index_gt90pct_may_sep    1.56   2.65 
##  5 days_heat_index_gt95pct            2.64   3.33 
##  6 days_heat_index_gt95pct_may_sep    0.252  0.728
##  7 days_heat_index_max_gt1sd         79.1   29.8  
##  8 days_heat_index_max_gt1sd_may_sep 36.6   19.3  
##  9 days_heat_index_max_gt2sd         20.3   16.2  
## 10 days_heat_index_max_gt2sd_may_sep 11.4   10.8  
## # ... with 74 more rows</code></pre>
</div>
<div id="multiple-models-function" class="section level2">
<h2>Multiple Models Function</h2>
<pre class="r"><code>random_slope_bct_function = function(df) {
  df %&gt;% 
    glmer(count ~ value_scaled + bct + (1 + value_scaled|installation), data = ., family = poisson, offset = log(population))
}

# Ambulatory nested models

random_slope_bct_nest &lt;-
  joined_hsi_amb %&gt;%
    dplyr::select(index, everything()) %&gt;% 
      nest(data = installation:value_scaled) %&gt;% 
      mutate(glmer_models = map(data, random_slope_bct_function),
             glance = map(glmer_models, broom::glance),
             tidy =   map(glmer_models, broom::tidy),
             augment = map(glmer_models, broom::augment))</code></pre>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<pre class="r"><code>random_slope_bct_nest </code></pre>
<pre><code>## # A tibble: 84 x 6
##    index               data glmer_models glance       tidy        augment       
##    &lt;chr&gt;       &lt;list&lt;df[,8&gt; &lt;list&gt;       &lt;list&gt;       &lt;list&gt;      &lt;list&gt;        
##  1 tmp_f_mean     [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
##  2 heat_index~    [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
##  3 wbgt_f_mean    [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
##  4 tmp_f_max      [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
##  5 heat_index~    [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
##  6 wbgt_f_max     [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
##  7 tmp_f_min      [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
##  8 heat_index~    [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
##  9 wbgt_f_min     [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
## 10 tmp_f_sd       [242 x 8] &lt;glmerMod&gt;   &lt;tibble [1 ~ &lt;tibble [6~ &lt;df[,16] [242~
## # ... with 74 more rows</code></pre>
<pre class="r"><code>random_slope_bct_nest$index %&gt;% View()
# Check singular fit models

map(random_slope_bct_nest$glmer_models, isSingular) %&gt;% 
  unlist() %&gt;% 
  tibble::enframe(name = NULL) %&gt;% 
  mutate(index = random_slope_bct_nest$index) %&gt;% 
  filter(value %in% &quot;TRUE&quot;)</code></pre>
<pre><code>## # A tibble: 1 x 2
##   value index                    
##   &lt;lgl&gt; &lt;chr&gt;                    
## 1 TRUE  days_wbgt_gt95pct_may_sep</code></pre>
<pre class="r"><code># Remove `days_wbgt_gt95pct_may_sep`: singular fit model

random_slope_bct_nest &lt;-
  random_slope_bct_nest %&gt;% 
  filter(!index %in% &quot;days_wbgt_gt95pct_may_sep&quot;)


# write_rds(random_slope_bct_nest, &quot;data/random_slope_bct_nest.rds&quot;, compress = &quot;none&quot;)



# Model summaries

# Arranged by magnitude of index value estimate

random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;value_scaled&quot;) %&gt;% 
  arrange(desc(estimate))</code></pre>
<pre><code>## # A tibble: 83 x 7
##    index           term         estimate std.error statistic     p.value group
##    &lt;chr&gt;           &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;
##  1 hours_wbgt_gt82 value_scaled    1.41      0.603      2.34 0.0192      fixed
##  2 heat_index_mean value_scaled    1.09      0.219      4.99 0.000000594 fixed
##  3 tmp_f_mean      value_scaled    0.964     0.195      4.93 0.000000823 fixed
##  4 wbgt_f_mean     value_scaled    0.848     0.205      4.15 0.0000338   fixed
##  5 days_hi_gt80    value_scaled    0.699     0.231      3.02 0.00249     fixed
##  6 days_wbgt_gt82  value_scaled    0.664     0.148      4.48 0.00000758  fixed
##  7 hours_hi_gt80   value_scaled    0.637     0.160      3.99 0.0000670   fixed
##  8 hours_wbgt_gt85 value_scaled    0.593     0.183      3.23 0.00123     fixed
##  9 hours_hi_gt90   value_scaled    0.580     0.120      4.84 0.00000130  fixed
## 10 hours_wbgt_gt90 value_scaled    0.544     0.237      2.29 0.0220      fixed
## # ... with 73 more rows</code></pre>
<pre class="r"><code># Arranged by magnitude of &quot;bct&quot; estimate

random_slope_bct_nest  %&gt;% 
  unnest(tidy, .drop = TRUE) %&gt;% 
  dplyr::select(index, term:group) %&gt;%
  filter(term %in% &quot;bct&quot;) %&gt;% 
  arrange(desc(estimate))</code></pre>
<pre><code>## # A tibble: 83 x 7
##    index                       term  estimate std.error statistic  p.value group
##    &lt;chr&gt;                       &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
##  1 tmp_f_mean                  bct       2.32     0.554      4.19  2.81e-5 fixed
##  2 heat_index_mean             bct       2.13     0.732      2.91  3.63e-3 fixed
##  3 hours_hi_gt80               bct       1.84     0.868      2.12  3.42e-2 fixed
##  4 wbgt_f_mean                 bct       1.68     0.675      2.49  1.26e-2 fixed
##  5 heat_index_mean_anomaly_me~ bct       1.68     0.745      2.26  2.39e-2 fixed
##  6 days_hi_gt80                bct       1.64     0.603      2.72  6.54e-3 fixed
##  7 tmp_f_max_anomaly_mean      bct       1.62     0.578      2.81  4.96e-3 fixed
##  8 days_tmp_max_gt1sd          bct       1.54     0.570      2.70  6.94e-3 fixed
##  9 tmp_f_mean_anomaly_mean_ma~ bct       1.53     0.633      2.41  1.59e-2 fixed
## 10 tmp_f_max_anomaly_mean_may~ bct       1.52     0.557      2.72  6.47e-3 fixed
## # ... with 73 more rows</code></pre>
<pre class="r"><code># Arranged by AIC (lower is better)

random_slope_bct_nest  %&gt;% 
  unnest(glance, .drop = TRUE) %&gt;% 
  dplyr::select(index, sigma:df.residual) %&gt;% 
  arrange(AIC)</code></pre>
<pre><code>## # A tibble: 83 x 7
##    index                       sigma logLik    AIC    BIC deviance df.residual
##    &lt;chr&gt;                       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;
##  1 days_wbgt_max_gt85pct           1 -6227. 12466. 12487.   10821.         236
##  2 days_hi_gt80                    1 -6234. 12481. 12502.   10825.         236
##  3 days_heat_index_max_gt1sd       1 -6243. 12499. 12520.   10857.         236
##  4 days_heat_index_max_gt90pct     1 -6247. 12507. 12528.   10861.         236
##  5 days_wbgt_max_gt90pct           1 -6310. 12631. 12652.   10988.         236
##  6 days_wbgt_max_gt1sd             1 -6330. 12672. 12693.   11025.         236
##  7 days_heat_index_max_gt95pct     1 -6333. 12678. 12699.   11036.         236
##  8 days_heat_index_max_gt85pct     1 -6404. 12821. 12842.   11177.         236
##  9 hours_hi_gt80                   1 -6430. 12872. 12893.   11228.         236
## 10 days_wbgt_max_gt2sd             1 -6455. 12921. 12942.   11272.         236
## # ... with 73 more rows</code></pre>
</div>
<div id="plot-estimates-of-all-nested-models" class="section level2">
<h2>Plot estimates of all nested models</h2>
<pre class="r"><code>#random_slope_bct_nest %&gt;% 
#  pull(glmer_models) %&gt;% 
#  map(sjPlot::plot_model)
#  
#

# Plot 10

models_10_names &lt;-
  random_slope_bct_nest  %&gt;% 
      unnest(tidy, .drop = TRUE) %&gt;% 
      dplyr::select(index, term:group) %&gt;%
      filter(term %in% &quot;value_scaled&quot;) %&gt;% 
      arrange(desc(estimate)) %&gt;% 
      slice(1:10) %&gt;%
      pull(index)
           
models_10 &lt;-
  random_slope_bct_nest %&gt;% 
  filter(index %in% models_10_names) %&gt;% 
  pull(glmer_models)

map2(.x = models_10, .y = models_10_names, .f = ~ sjPlot::plot_model(.x, title = .y))  </code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-3.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-4.png" width="672" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-5.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-6.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-7.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-8.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-9.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-10.png" width="672" /></p>
<pre class="r"><code>map2(.x = models_10, .y = models_10_names, .f = ~ sjPlot::plot_model(.x, type = &quot;pred&quot;, terms = &quot;value_scaled&quot;, title = .y))</code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-11.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-12.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-13.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-14.png" width="672" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-15.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-16.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-17.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-18.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-19.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-20.png" width="672" /></p>
<pre class="r"><code>map2(.x = models_10, .y = models_10_names, .f = ~ sjPlot::plot_model(.x, type = &quot;re&quot;, terms = &quot;value_scaled&quot;, title = .y))</code></pre>
<pre><code>## [[1]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-21.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-22.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-23.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-24.png" width="672" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-25.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-26.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-27.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-28.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-29.png" width="672" /></p>
<pre><code>## 
## [[10]]</code></pre>
<p><img src="mixed_poisson_files/figure-html/plot_all_models-30.png" width="672" /></p>
<pre class="r"><code>index_mean_sd %&gt;% 
  filter(index %in% models_10_names) %&gt;% 
  knitr::kable(digits = 3) %&gt;% 
  kableExtra::kable_styling()</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
index
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
days_hi_gt80
</td>
<td style="text-align:right;">
125.322
</td>
<td style="text-align:right;">
46.345
</td>
</tr>
<tr>
<td style="text-align:left;">
days_wbgt_gt82
</td>
<td style="text-align:right;">
62.393
</td>
<td style="text-align:right;">
40.198
</td>
</tr>
<tr>
<td style="text-align:left;">
heat_index_mean
</td>
<td style="text-align:right;">
59.357
</td>
<td style="text-align:right;">
5.961
</td>
</tr>
<tr>
<td style="text-align:left;">
hours_hi_gt80
</td>
<td style="text-align:right;">
1483.756
</td>
<td style="text-align:right;">
764.248
</td>
</tr>
<tr>
<td style="text-align:left;">
hours_hi_gt90
</td>
<td style="text-align:right;">
491.434
</td>
<td style="text-align:right;">
391.567
</td>
</tr>
<tr>
<td style="text-align:left;">
hours_wbgt_gt82
</td>
<td style="text-align:right;">
418.810
</td>
<td style="text-align:right;">
342.693
</td>
</tr>
<tr>
<td style="text-align:left;">
hours_wbgt_gt85
</td>
<td style="text-align:right;">
194.095
</td>
<td style="text-align:right;">
187.493
</td>
</tr>
<tr>
<td style="text-align:left;">
hours_wbgt_gt90
</td>
<td style="text-align:right;">
20.521
</td>
<td style="text-align:right;">
27.828
</td>
</tr>
<tr>
<td style="text-align:left;">
tmp_f_mean
</td>
<td style="text-align:right;">
60.022
</td>
<td style="text-align:right;">
5.840
</td>
</tr>
<tr>
<td style="text-align:left;">
wbgt_f_mean
</td>
<td style="text-align:right;">
55.561
</td>
<td style="text-align:right;">
5.139
</td>
</tr>
</tbody>
</table>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

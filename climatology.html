<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>climatology</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="shortcut icon" href="favicon.ico">

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Heat Stress Research</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Data Preparation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Meteorology Data</li>
    <li>
      <a href="shapefiles.html">Installation Shapefiles</a>
    </li>
    <li>
      <a href="nldas_wget.html">Download NLDAS-2 Data</a>
    </li>
    <li>
      <a href="extract_cells.html">Extract from NLDAS netCDF Files</a>
    </li>
    <li>
      <a href="installation_nldas.html">Tidy NLDAS Data for Analysis</a>
    </li>
    <li>
      <a href="nldas_indices.html">NLDAS Conversions and Indices</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Outcome Data</li>
    <li>
      <a href="dmed_read.html">DMED Queries</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-thermometer"></span>
     
    Meteorology
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="nldas_timeseries.html">Time series formats (zoo, xts, ts)</a>
    </li>
    <li>
      <a href="nldas_fable.html">Time series (Fable)</a>
    </li>
    <li>
      <a href="nldas_averaged.html">Aggregate over calendar periods</a>
    </li>
    <li>
      <a href="climatology.html">Climatologies / Anomalies</a>
    </li>
    <li>
      <a href="annual_tables.html">Annual index tables</a>
    </li>
    <li>
      <a href="af_weather.html">Air Force weather station data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-medkit"></span>
     
    Heat Illness
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Annual</li>
    <li>
      <a href="dmed_summary.html">Annual cases</a>
    </li>
    <li class="dropdown-header">Daily</li>
    <li class="dropdown-header">Daily cases</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-line-chart"></span>
     
    Models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Annual</li>
    <li>
      <a href="dmed_models.html">Annual models</a>
    </li>
    <li class="dropdown-header">Daily</li>
    <li>
      <a href="case_crossover.html">Case-crossover models</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="mailto:sal2222@cumc.columbia.edu">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/sal2222/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">climatology</h1>

</div>


<pre class="r"><code>nldas_wide &lt;- read_rds(&quot;data/nldas_wide.rds&quot;)

# Add one second to duplicate times
local_dst_adjust &lt;-
  nldas_wide %&gt;%
    mutate(row = dplyr::row_number()) %&gt;% 
    tsibble::duplicates(key = installation, index = local_dttm) %&gt;% 
    filter(local_dttm != lead(local_dttm, default = &quot;1&quot;)) %&gt;% 
    mutate(local_dttm = local_dttm + seconds(1))

local_dst_adjust</code></pre>
<pre><code>## # A tibble: 725 x 20
##    utc_dttm            local_dttm          installation longitude latitude   TMP
##    &lt;dttm&gt;              &lt;dttm&gt;              &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 1990-10-28 07:00:00 1990-10-28 01:00:01 eglin_afb        -86.5     30.6  287.
##  2 1991-10-27 07:00:00 1991-10-27 01:00:01 eglin_afb        -86.5     30.6  296.
##  3 1992-10-25 07:00:00 1992-10-25 01:00:01 eglin_afb        -86.5     30.6  292.
##  4 1993-10-31 07:00:00 1993-10-31 01:00:01 eglin_afb        -86.5     30.6  279.
##  5 1994-10-30 07:00:00 1994-10-30 01:00:01 eglin_afb        -86.5     30.6  292.
##  6 1995-10-29 07:00:00 1995-10-29 01:00:01 eglin_afb        -86.5     30.6  285.
##  7 1996-10-27 07:00:00 1996-10-27 01:00:01 eglin_afb        -86.5     30.6  296.
##  8 1997-10-26 07:00:00 1997-10-26 01:00:01 eglin_afb        -86.5     30.6  297.
##  9 1998-10-25 07:00:00 1998-10-25 01:00:01 eglin_afb        -86.5     30.6  288.
## 10 1999-10-31 07:00:00 1999-10-31 01:00:01 eglin_afb        -86.5     30.6  292.
## # ... with 715 more rows, and 14 more variables: SPFH &lt;dbl&gt;, PRES &lt;dbl&gt;,
## #   UGRD &lt;dbl&gt;, VGRD &lt;dbl&gt;, DSWRF &lt;dbl&gt;, windspeed &lt;dbl&gt;, tmp_f &lt;dbl&gt;,
## #   tmp_c &lt;dbl&gt;, rh &lt;dbl&gt;, dp_c &lt;dbl&gt;, heat_index &lt;dbl&gt;, wbgt &lt;dbl&gt;,
## #   wbgt_f &lt;dbl&gt;, row &lt;int&gt;</code></pre>
<pre class="r"><code># Remove rows with duplicate local times and replace with updated rows (+1 second)

nldas_wide &lt;-
  nldas_wide %&gt;%
    mutate(row = dplyr::row_number()) %&gt;% 
    filter(!row %in% local_dst_adjust$row) %&gt;% 
    bind_rows(local_dst_adjust) %&gt;% 
    arrange(local_dttm) %&gt;% 
    dplyr::select(-row) %&gt;% 
    dplyr::select(installation, local_dttm, tmp_f, heat_index, wbgt_f) </code></pre>
<div id="construct-climatology-1990-2018" class="section level2">
<h2>Construct climatology (1990-2018)</h2>
<pre class="r"><code>#Construct climatology (1990-2018)

# Create month and day columns, restrict years

nldas_wide &lt;-
  nldas_wide %&gt;% 
  filter(lubridate::year(local_dttm) &lt; 2019 &amp;
           lubridate::year(local_dttm) &gt; 1989) %&gt;%
    mutate(month = month(local_dttm), 
           day = day(local_dttm)) 

nldas_wide</code></pre>
<pre><code>## # A tibble: 6,355,200 x 7
##    installation    local_dttm          tmp_f heat_index wbgt_f month   day
##    &lt;chr&gt;           &lt;dttm&gt;              &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1 eglin_afb       1990-01-01 00:00:00  54.7       54.1   53.2     1     1
##  2 fort_benning_ga 1990-01-01 00:00:00  53.4       52.8   52.1     1     1
##  3 fort_bliss      1990-01-01 00:00:00  38.8       38.8   37.4     1     1
##  4 fort_bragg      1990-01-01 00:00:00  34.4       34.4   32.5     1     1
##  5 fort_campbell   1990-01-01 00:00:00  35.4       35.4   29.9     1     1
##  6 fort_carson     1990-01-01 00:00:00  37.4       37.4   30.7     1     1
##  7 fort_drum       1990-01-01 00:00:00  62.4       62.8   61.5     1     1
##  8 fort_gordon     1990-01-01 00:00:00  40.8       37.0   35.3     1     1
##  9 fort_hood       1990-01-01 00:00:00  58.4       58.4   57.2     1     1
## 10 fort_jackson    1990-01-01 00:00:00  23.2       23.2   20.6     1     1
## # ... with 6,355,190 more rows</code></pre>
<pre class="r"><code># Nest by installation
nest_nldas &lt;-
  nldas_wide %&gt;% 
    nest(., data = local_dttm:day)

nest_nldas</code></pre>
<pre><code>## # A tibble: 25 x 2
##    installation              data
##    &lt;chr&gt;           &lt;list&lt;df[,6]&gt;&gt;
##  1 eglin_afb        [254,208 x 6]
##  2 fort_benning_ga  [254,208 x 6]
##  3 fort_bliss       [254,208 x 6]
##  4 fort_bragg       [254,208 x 6]
##  5 fort_campbell    [254,208 x 6]
##  6 fort_carson      [254,208 x 6]
##  7 fort_drum        [254,208 x 6]
##  8 fort_gordon      [254,208 x 6]
##  9 fort_hood        [254,208 x 6]
## 10 fort_jackson     [254,208 x 6]
## # ... with 15 more rows</code></pre>
<pre class="r"><code>nest_nldas %&gt;% slice(1) %&gt;% unnest(data)</code></pre>
<pre><code>## # A tibble: 254,208 x 7
##    installation local_dttm          tmp_f heat_index wbgt_f month   day
##    &lt;chr&gt;        &lt;dttm&gt;              &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1 eglin_afb    1990-01-01 00:00:00  54.7       54.1   53.2     1     1
##  2 eglin_afb    1990-01-01 01:00:00  53.2       52.4   51.5     1     1
##  3 eglin_afb    1990-01-01 02:00:00  51.8       50.7   49.8     1     1
##  4 eglin_afb    1990-01-01 03:00:00  50.4       49     48.0     1     1
##  5 eglin_afb    1990-01-01 04:00:00  48.9       47.3   46.5     1     1
##  6 eglin_afb    1990-01-01 05:00:00  47.4       45.7   45.0     1     1
##  7 eglin_afb    1990-01-01 06:00:00  45.9       44.0   43.4     1     1
##  8 eglin_afb    1990-01-01 07:00:00  46.0       43.8   43.4     1     1
##  9 eglin_afb    1990-01-01 08:00:00  46.0       43.7   44.8     1     1
## 10 eglin_afb    1990-01-01 09:00:00  46.0       43.5   46.1     1     1
## # ... with 254,198 more rows</code></pre>
<pre class="r"><code># Define Percentile Functions 
  # https://tbradley1013.github.io/2018/10/01/calculating-quantiles-for-groups-with-dplyr-summarize-and-purrr-partial/

percentiles &lt;- c(0.85, 0.9, 0.95)

percentile_names &lt;- map_chr(percentiles, ~paste0(.x * 100, &quot;%&quot;))

percentile_funs &lt;- map(percentiles, ~partial(quantile, probs = .x, na.rm = TRUE)) %&gt;% 
  set_names(nm = percentile_names)

percentile_funs</code></pre>
<pre><code>## $`85%`
## &lt;partialised&gt;
## function (...) 
## quantile(probs = .x, na.rm = TRUE, ...)
## 
## $`90%`
## &lt;partialised&gt;
## function (...) 
## quantile(probs = .x, na.rm = TRUE, ...)
## 
## $`95%`
## &lt;partialised&gt;
## function (...) 
## quantile(probs = .x, na.rm = TRUE, ...)</code></pre>
<pre class="r"><code># Climatology (daily) function

climatology_function &lt;- function(df) {
  df %&gt;% 
    group_by(month, day) %&gt;% 
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(mean = &quot;mean&quot;, max = &quot;max&quot;, min = &quot;min&quot;, sd = &quot;sd&quot;, percentile_funs)) %&gt;% 
    unite(mon_day, month:day, sep = &quot;-&quot;, remove = FALSE)
}

      ## Percentiles are averaged over all daily temperatures, not daily maximums

# Map climatology function

nldas_climatology &lt;- 
  nest_nldas %&gt;% 
    mutate(climatology = 
      map(nest_nldas$data, climatology_function))


nldas_climatology</code></pre>
<pre><code>## # A tibble: 25 x 3
##    installation              data climatology        
##    &lt;chr&gt;           &lt;list&lt;df[,6]&gt;&gt; &lt;list&gt;             
##  1 eglin_afb        [254,208 x 6] &lt;tibble [366 x 24]&gt;
##  2 fort_benning_ga  [254,208 x 6] &lt;tibble [366 x 24]&gt;
##  3 fort_bliss       [254,208 x 6] &lt;tibble [366 x 24]&gt;
##  4 fort_bragg       [254,208 x 6] &lt;tibble [366 x 24]&gt;
##  5 fort_campbell    [254,208 x 6] &lt;tibble [366 x 24]&gt;
##  6 fort_carson      [254,208 x 6] &lt;tibble [366 x 24]&gt;
##  7 fort_drum        [254,208 x 6] &lt;tibble [366 x 24]&gt;
##  8 fort_gordon      [254,208 x 6] &lt;tibble [366 x 24]&gt;
##  9 fort_hood        [254,208 x 6] &lt;tibble [366 x 24]&gt;
## 10 fort_jackson     [254,208 x 6] &lt;tibble [366 x 24]&gt;
## # ... with 15 more rows</code></pre>
<pre class="r"><code>nldas_climatology$climatology[[1]]</code></pre>
<pre><code>## # A tibble: 366 x 24
## # Groups:   month [12]
##    mon_day month   day tmp_f_mean heat_index_mean wbgt_f_mean tmp_f_max
##    &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;
##  1 1-1         1     1       55.4            54.9        54.1      74.6
##  2 1-2         1     2       54.4            53.9        53.1      74.1
##  3 1-3         1     3       51.3            50.7        49.8      75.1
##  4 1-4         1     4       51.6            50.8        50.2      75.3
##  5 1-5         1     5       53.4            52.8        52.3      74.7
##  6 1-6         1     6       54.2            53.5        52.9      75.2
##  7 1-7         1     7       51.9            51.2        50.6      74.2
##  8 1-8         1     8       51.7            51.1        50.5      73.0
##  9 1-9         1     9       53.8            53.3        52.6      75.4
## 10 1-10        1    10       54.2            53.6        53.0      76.6
## # ... with 356 more rows, and 17 more variables: heat_index_max &lt;dbl&gt;,
## #   wbgt_f_max &lt;dbl&gt;, tmp_f_min &lt;dbl&gt;, heat_index_min &lt;dbl&gt;, wbgt_f_min &lt;dbl&gt;,
## #   tmp_f_sd &lt;dbl&gt;, heat_index_sd &lt;dbl&gt;, wbgt_f_sd &lt;dbl&gt;, `tmp_f_85%` &lt;dbl&gt;,
## #   `heat_index_85%` &lt;dbl&gt;, `wbgt_f_85%` &lt;dbl&gt;, `tmp_f_90%` &lt;dbl&gt;,
## #   `heat_index_90%` &lt;dbl&gt;, `wbgt_f_90%` &lt;dbl&gt;, `tmp_f_95%` &lt;dbl&gt;,
## #   `heat_index_95%` &lt;dbl&gt;, `wbgt_f_95%` &lt;dbl&gt;</code></pre>
</div>
<div id="anomalies-daily" class="section level2">
<h2>Anomalies (Daily)</h2>
<div id="daily-anomaly-mean" class="section level3">
<h3>Daily anomaly (mean)</h3>
<p>Mean daily temperature/index compared to the mean of the temperatures over the climatology period on the same day of year.</p>
<pre class="r"><code># Single Installation

## Mean daily anomalies
nldas_climatology$data[[1]] %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(mean = &quot;mean&quot;)) %&gt;%
    ungroup() %&gt;%
    mutate(month = month(date),
           day = day(date)) %&gt;% 
    left_join(., nldas_climatology$climatology[[1]], by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
    mutate(tmp_f_mean_anomaly = tmp_f_mean.x - tmp_f_mean.y, 
            heat_index_mean_anomaly = heat_index_mean.x - heat_index_mean.y,
            wbgt_f_mean_anomaly = wbgt_f_mean.x - wbgt_f_mean.y) %&gt;% 
  dplyr::select(date, tmp_f_mean_anomaly, heat_index_mean_anomaly, wbgt_f_mean_anomaly)</code></pre>
<pre><code>## # A tibble: 10,592 x 4
##    date       tmp_f_mean_anomaly heat_index_mean_anomaly wbgt_f_mean_anomaly
##    &lt;date&gt;                  &lt;dbl&gt;                   &lt;dbl&gt;               &lt;dbl&gt;
##  1 1990-01-01             -7.49                  -9.21                 -8.33
##  2 1990-01-02             -6.61                  -8.40                 -8.19
##  3 1990-01-03              4.46                   4.26                  4.46
##  4 1990-01-04              8.41                   9.07                  9.04
##  5 1990-01-05              7.32                   8.00                  7.78
##  6 1990-01-06              6.31                   6.96                  7.04
##  7 1990-01-07              8.68                   9.50                  9.32
##  8 1990-01-08              0.580                  0.0591                1.11
##  9 1990-01-09             -2.29                  -3.03                 -2.05
## 10 1990-01-10              1.92                   1.58                  1.81
## # ... with 10,582 more rows</code></pre>
<pre class="r"><code># Function
### Daily Mean
anomaly_daily_mean_function &lt;- function(data, climatology) {
data %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(mean = &quot;mean&quot;)) %&gt;%
    mutate(month = month(date),
           day = day(date)) %&gt;% 
    left_join(., climatology, by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
    mutate(tmp_f_mean_anomaly = tmp_f_mean.x - tmp_f_mean.y, 
            heat_index_mean_anomaly = heat_index_mean.x - heat_index_mean.y,
            wbgt_f_mean_anomaly = wbgt_f_mean.x - wbgt_f_mean.y) %&gt;% 
  dplyr::select(date, tmp_f_mean_anomaly, heat_index_mean_anomaly, wbgt_f_mean_anomaly) %&gt;% 
  group_by(year = lubridate::year(date)) %&gt;% 
       summarise_at(
         .vars = vars(tmp_f_mean_anomaly, heat_index_mean_anomaly, wbgt_f_mean_anomaly),
            .funs = c(mean = &quot;mean&quot;)) 
}


nldas_climatology &lt;-
  nldas_climatology %&gt;% 
    mutate(anomaly_daily_mean =
        map2(.x = nldas_climatology$data, .y = nldas_climatology$climatology, .f = anomaly_daily_mean_function))

nldas_climatology</code></pre>
<pre><code>## # A tibble: 25 x 4
##    installation              data climatology         anomaly_daily_mean
##    &lt;chr&gt;           &lt;list&lt;df[,6]&gt;&gt; &lt;list&gt;              &lt;list&gt;            
##  1 eglin_afb        [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
##  2 fort_benning_ga  [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
##  3 fort_bliss       [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
##  4 fort_bragg       [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
##  5 fort_campbell    [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
##  6 fort_carson      [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
##  7 fort_drum        [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
##  8 fort_gordon      [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
##  9 fort_hood        [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
## 10 fort_jackson     [254,208 x 6] &lt;tibble [366 x 24]&gt; &lt;tibble [29 x 4]&gt; 
## # ... with 15 more rows</code></pre>
<pre class="r"><code>nldas_climatology$anomaly_daily_mean[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 4
##     year tmp_f_mean_anomaly_me~ heat_index_mean_anomaly_~ wbgt_f_mean_anomaly_m~
##    &lt;dbl&gt;                  &lt;dbl&gt;                     &lt;dbl&gt;                  &lt;dbl&gt;
##  1  1990                 1.16                       1.14                  0.928 
##  2  1991                 0.366                      0.304                 0.200 
##  3  1992                -0.853                     -1.37                 -1.06  
##  4  1993                -0.724                     -0.908                -1.00  
##  5  1994                -0.0144                    -0.486                -0.0829
##  6  1995                -0.218                     -0.232                -0.398 
##  7  1996                -0.955                     -1.20                 -1.07  
##  8  1997                -0.486                     -0.664                -0.566 
##  9  1998                 1.20                       1.60                  1.10  
## 10  1999                 0.297                      0.161                -0.0552
## # ... with 19 more rows</code></pre>
</div>
<div id="daily-anomaly-maximum" class="section level3">
<h3>Daily anomaly (maximum)</h3>
<p>Maximum daily temperature/index compared to the mean of the maximum daily temperatures on the same day of year over the climatology period.</p>
<pre class="r"><code>left_join(
nldas_climatology$data[[1]] %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(max = &quot;max&quot;)) %&gt;%
    mutate(month = month(date),
           day = day(date)),

nldas_climatology$data[[1]] %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(max = &quot;max&quot;)) %&gt;%
    mutate(month = month(date),
           day = day(date)) %&gt;% 
  group_by(month, day) %&gt;% 
     summarise(mean_tmp_f_max = mean(tmp_f_max),
               mean_heat_index_max = mean(heat_index_max),
               mean_wbgt_f_max = mean(wbgt_f_max)),
by = c(&quot;month&quot;, &quot;day&quot;)
) %&gt;% 
  mutate(tmp_f_max_anomaly = tmp_f_max - mean_tmp_f_max, 
         heat_index_max_anomaly = heat_index_max - mean_heat_index_max,
         wbgt_f_max_anomaly = wbgt_f_max - mean_wbgt_f_max) %&gt;% 
   group_by(year = lubridate::year(date)) %&gt;% 
   summarise_at(
         .vars = vars(tmp_f_max_anomaly, heat_index_max_anomaly, wbgt_f_max_anomaly),
            .funs = c(mean = &quot;mean&quot;)) </code></pre>
<pre><code>## # A tibble: 29 x 4
##     year tmp_f_max_anomaly_mean heat_index_max_anomaly_m~ wbgt_f_max_anomaly_me~
##    &lt;dbl&gt;                  &lt;dbl&gt;                     &lt;dbl&gt;                  &lt;dbl&gt;
##  1  1990                 1.58                       1.56                   1.39 
##  2  1991                -0.0538                    -0.111                 -0.174
##  3  1992                -1.01                      -1.71                  -1.23 
##  4  1993                -0.762                     -1.26                  -1.17 
##  5  1994                -0.337                     -0.805                 -0.398
##  6  1995                -0.238                     -0.373                 -0.572
##  7  1996                -0.784                     -1.19                  -0.957
##  8  1997                -1.20                      -1.53                  -0.932
##  9  1998                 1.10                       1.53                   0.610
## 10  1999                 0.617                      0.387                  0.196
## # ... with 19 more rows</code></pre>
<pre class="r"><code># Function
### Daily Max
anomaly_daily_max_function &lt;- function(data) {
  left_join(
    data %&gt;% 
      mutate(date = as.Date(local_dttm)) %&gt;% 
      group_by(date) %&gt;% # daily aggregates
        dplyr::summarise_at(
              .vars = vars(tmp_f, heat_index, wbgt_f),
              .funs = c(max = &quot;max&quot;)) %&gt;%
        mutate(month = month(date),
               day = day(date)),
  
    data %&gt;% 
      mutate(date = as.Date(local_dttm)) %&gt;% 
      group_by(date) %&gt;% # daily aggregates
        dplyr::summarise_at(
              .vars = vars(tmp_f, heat_index, wbgt_f),
              .funs = c(max = &quot;max&quot;)) %&gt;%
        mutate(month = month(date),
               day = day(date)) %&gt;% 
      group_by(month, day) %&gt;% 
         summarise(mean_tmp_f_max = mean(tmp_f_max),
                   mean_heat_index_max = mean(heat_index_max),
                   mean_wbgt_f_max = mean(wbgt_f_max)),
    by = c(&quot;month&quot;, &quot;day&quot;)
    ) %&gt;% 
      mutate(tmp_f_max_anomaly = tmp_f_max - mean_tmp_f_max, 
             heat_index_max_anomaly = heat_index_max - mean_heat_index_max,
             wbgt_f_max_anomaly = wbgt_f_max - mean_wbgt_f_max) %&gt;% 
       group_by(year = lubridate::year(date)) %&gt;% 
       summarise_at(
             .vars = vars(tmp_f_max_anomaly, heat_index_max_anomaly, wbgt_f_max_anomaly),
                .funs = c(mean = &quot;mean&quot;)) 
  }


nldas_climatology &lt;-
  nldas_climatology %&gt;% 
    mutate(anomaly_daily_max =
        map(.x = nldas_climatology$data, .f = anomaly_daily_max_function))

nldas_climatology</code></pre>
<pre><code>## # A tibble: 25 x 5
##    installation            data climatology    anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;         &lt;list&lt;df[,6]&gt;&gt; &lt;list&gt;         &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb      [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_benning~  [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss     [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg     [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbell  [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson    [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum      [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon    [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood      [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson   [254,208 x 6] &lt;tibble [366 ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows</code></pre>
<pre class="r"><code>nldas_climatology$anomaly_daily_max[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 4
##     year tmp_f_max_anomaly_mean heat_index_max_anomaly_m~ wbgt_f_max_anomaly_me~
##    &lt;dbl&gt;                  &lt;dbl&gt;                     &lt;dbl&gt;                  &lt;dbl&gt;
##  1  1990                 1.58                       1.56                   1.39 
##  2  1991                -0.0538                    -0.111                 -0.174
##  3  1992                -1.01                      -1.71                  -1.23 
##  4  1993                -0.762                     -1.26                  -1.17 
##  5  1994                -0.337                     -0.805                 -0.398
##  6  1995                -0.238                     -0.373                 -0.572
##  7  1996                -0.784                     -1.19                  -0.957
##  8  1997                -1.20                      -1.53                  -0.932
##  9  1998                 1.10                       1.53                   0.610
## 10  1999                 0.617                      0.387                  0.196
## # ... with 19 more rows</code></pre>
</div>
<div id="days-mean-temperature-index-above-climate-normal-percentile-averaged-over-all-hours-of-day" class="section level3">
<h3>Days mean temperature index above climate normal percentile (averaged over all hours of day)</h3>
<pre class="r"><code># Single installation

nldas_climatology$data[[1]] %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(mean = &quot;mean&quot;, max = &quot;max&quot;, min = &quot;min&quot;)) %&gt;%
    ungroup() %&gt;%
    mutate(month = month(date),
           day = day(date)) %&gt;% 
    left_join(., nldas_climatology$climatology[[1]], by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
    group_by(year = lubridate::year(date)) %&gt;% 
     summarise(
      days_tmp_gt85pct = sum(tmp_f_mean.x &gt; `tmp_f_85%`), 
      days_tmp_gt90pct = sum(tmp_f_mean.x &gt; `tmp_f_90%`),  
      days_tmp_gt95pct = sum(tmp_f_mean.x &gt; `tmp_f_95%`),
      days_heat_index_gt85pct = sum(heat_index_mean.x &gt; `heat_index_85%`), 
      days_heat_index_gt90pct = sum(heat_index_mean.x &gt; `heat_index_90%`),  
      days_heat_index_gt95pct = sum(heat_index_mean.x &gt; `heat_index_95%`), 
      days_wbgt_gt85pct = sum(wbgt_f_mean.x &gt; `wbgt_f_85%`), 
      days_wbgt_gt90pct = sum(wbgt_f_mean.x &gt; `wbgt_f_90%`),  
      days_wbgt_gt95pct = sum(wbgt_f_mean.x &gt; `wbgt_f_95%`)) </code></pre>
<pre><code>## # A tibble: 29 x 10
##     year days_tmp_gt85pct days_tmp_gt90pct days_tmp_gt95pct days_heat_index~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               22               12                1               25
##  2  1991               11                4                0               16
##  3  1992                2                0                0                5
##  4  1993                7                3                0                9
##  5  1994               10                4                0               13
##  6  1995                5                1                0               13
##  7  1996               11                3                0               20
##  8  1997               15                5                0               23
##  9  1998               17                5                0               25
## 10  1999               22                9                0               32
## # ... with 19 more rows, and 5 more variables: days_heat_index_gt90pct &lt;int&gt;,
## #   days_heat_index_gt95pct &lt;int&gt;, days_wbgt_gt85pct &lt;int&gt;,
## #   days_wbgt_gt90pct &lt;int&gt;, days_wbgt_gt95pct &lt;int&gt;</code></pre>
<pre class="r"><code># Function

anomaly_days_function &lt;- function(data, climatology) {
  data %&gt;% 
    mutate(date = as.Date(local_dttm)) %&gt;% 
    group_by(date) %&gt;% # daily aggregates
      dplyr::summarise_at(
            .vars = vars(tmp_f, heat_index, wbgt_f),
            .funs = c(mean = &quot;mean&quot;, max = &quot;max&quot;, min = &quot;min&quot;)) %&gt;%
      ungroup() %&gt;%
      mutate(month = month(date),
             day = day(date)) %&gt;% 
      left_join(., climatology, by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
      group_by(year = lubridate::year(date)) %&gt;% 
       summarise(
        days_tmp_gt85pct = sum(tmp_f_mean.x &gt; `tmp_f_85%`), 
        days_tmp_gt90pct = sum(tmp_f_mean.x &gt; `tmp_f_90%`),  
        days_tmp_gt95pct = sum(tmp_f_mean.x &gt; `tmp_f_95%`),
        days_heat_index_gt85pct = sum(heat_index_mean.x &gt; `heat_index_85%`), 
        days_heat_index_gt90pct = sum(heat_index_mean.x &gt; `heat_index_90%`),  
        days_heat_index_gt95pct = sum(heat_index_mean.x &gt; `heat_index_95%`), 
        days_wbgt_gt85pct = sum(wbgt_f_mean.x &gt; `wbgt_f_85%`), 
        days_wbgt_gt90pct = sum(wbgt_f_mean.x &gt; `wbgt_f_90%`),  
        days_wbgt_gt95pct = sum(wbgt_f_mean.x &gt; `wbgt_f_95%`)) 
}

nldas_climatology &lt;-
  nldas_climatology %&gt;% 
    mutate(anomaly_days_mean =
        map2(.x = nldas_climatology$data, .y = nldas_climatology$climatology, .f = anomaly_days_function))

nldas_climatology</code></pre>
<pre><code>## # A tibble: 25 x 6
##    installation          data climatology anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;        &lt;list&lt;df[,6]&gt; &lt;list&gt;      &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_bennin~ [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss   [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg   [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbe~ [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson  [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon  [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows, and 1 more variable: anomaly_days_mean &lt;list&gt;</code></pre>
<pre class="r"><code>nldas_climatology$anomaly_days_mean[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 10
##     year days_tmp_gt85pct days_tmp_gt90pct days_tmp_gt95pct days_heat_index~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               22               12                1               25
##  2  1991               11                4                0               16
##  3  1992                2                0                0                5
##  4  1993                7                3                0                9
##  5  1994               10                4                0               13
##  6  1995                5                1                0               13
##  7  1996               11                3                0               20
##  8  1997               15                5                0               23
##  9  1998               17                5                0               25
## 10  1999               22                9                0               32
## # ... with 19 more rows, and 5 more variables: days_heat_index_gt90pct &lt;int&gt;,
## #   days_heat_index_gt95pct &lt;int&gt;, days_wbgt_gt85pct &lt;int&gt;,
## #   days_wbgt_gt90pct &lt;int&gt;, days_wbgt_gt95pct &lt;int&gt;</code></pre>
</div>
<div id="days-max-temperature-index-above-max-daily-climate-normal-percentile" class="section level3">
<h3>Days max temperature index above max daily climate normal percentile</h3>
<pre class="r"><code># Single installation

  left_join(
      nldas_climatology$data[[1]]  %&gt;% 
      group_by(date = date(local_dttm)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f, heat_index, wbgt_f),
            .funs = c(max = &quot;max&quot;)) %&gt;% 
        mutate(month = month(date), day = day(date)), 
      nldas_climatology$data[[1]] %&gt;% 
      group_by(date = date(local_dttm)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f, heat_index, wbgt_f),
            .funs = c(max = &quot;max&quot;)) %&gt;% 
    group_by(month = month(date), day = day(date)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f_max, heat_index_max, wbgt_f_max),
            .funs = percentile_funs), 
    by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
  group_by(year = lubridate::year(date)) %&gt;% 
      dplyr::summarise(
        days_tmp_max_gt85pct = sum(tmp_f_max &gt; `tmp_f_max_85%`), 
        days_tmp_max_gt90pct = sum(tmp_f_max &gt; `tmp_f_max_90%`),  
        days_tmp_max_gt95pct = sum(tmp_f_max &gt; `tmp_f_max_95%`),
        days_heat_index_max_gt85pct = sum(heat_index_max &gt; `heat_index_max_85%`), 
        days_heat_index_max_gt90pct = sum(heat_index_max &gt; `heat_index_max_90%`),  
        days_heat_index_max_gt95pct = sum(heat_index_max &gt; `heat_index_max_95%`), 
        days_wbgt_max_gt85pct = sum(wbgt_f_max &gt; `wbgt_f_max_85%`), 
        days_wbgt_max_gt90pct = sum(wbgt_f_max &gt; `wbgt_f_max_90%`),  
        days_wbgt_max_gt95pct = sum(wbgt_f_max &gt; `wbgt_f_max_95%`)) </code></pre>
<pre><code>## # A tibble: 29 x 10
##     year days_tmp_max_gt~ days_tmp_max_gt~ days_tmp_max_gt~ days_heat_index~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               78               53               37               73
##  2  1991               57               32               20               64
##  3  1992               30               13                7               20
##  4  1993               36               23               12               28
##  5  1994               41               24               11               40
##  6  1995               63               30               15               59
##  7  1996               63               32               17               57
##  8  1997               40               19               13               45
##  9  1998              101               67               43               93
## 10  1999               70               45               38               63
## # ... with 19 more rows, and 5 more variables:
## #   days_heat_index_max_gt90pct &lt;int&gt;, days_heat_index_max_gt95pct &lt;int&gt;,
## #   days_wbgt_max_gt85pct &lt;int&gt;, days_wbgt_max_gt90pct &lt;int&gt;,
## #   days_wbgt_max_gt95pct &lt;int&gt;</code></pre>
<pre class="r"><code># Function: daily max anomalies

anomaly_days_max_function &lt;- function(data) {
   left_join(
      data %&gt;% 
        group_by(date = date(local_dttm)) %&gt;% 
        dplyr::summarise_at(
              .vars = vars(tmp_f, heat_index, wbgt_f),
              .funs = c(max = &quot;max&quot;)) %&gt;% 
          mutate(month = month(date), day = day(date)), 
      data %&gt;% 
      group_by(date = date(local_dttm)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f, heat_index, wbgt_f),
            .funs = c(max = &quot;max&quot;)) %&gt;% 
    group_by(month = month(date), day = day(date)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f_max, heat_index_max, wbgt_f_max),
            .funs = percentile_funs), 
    by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
  group_by(year = lubridate::year(date)) %&gt;% 
      dplyr::summarise(
        days_tmp_max_gt85pct = sum(tmp_f_max &gt; `tmp_f_max_85%`), 
        days_tmp_max_gt90pct = sum(tmp_f_max &gt; `tmp_f_max_90%`),  
        days_tmp_max_gt95pct = sum(tmp_f_max &gt; `tmp_f_max_95%`),
        days_heat_index_max_gt85pct = sum(heat_index_max &gt; `heat_index_max_85%`), 
        days_heat_index_max_gt90pct = sum(heat_index_max &gt; `heat_index_max_90%`),  
        days_heat_index_max_gt95pct = sum(heat_index_max &gt; `heat_index_max_95%`), 
        days_wbgt_max_gt85pct = sum(wbgt_f_max &gt; `wbgt_f_max_85%`), 
        days_wbgt_max_gt90pct = sum(wbgt_f_max &gt; `wbgt_f_max_90%`),  
        days_wbgt_max_gt95pct = sum(wbgt_f_max &gt; `wbgt_f_max_95%`)) 
}
  
 

nldas_climatology &lt;-
  nldas_climatology %&gt;% 
    mutate(anomaly_days_max =
        map(.x = nldas_climatology$data, .f = anomaly_days_max_function))


nldas_climatology</code></pre>
<pre><code>## # A tibble: 25 x 7
##    installation          data climatology anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;        &lt;list&lt;df[,6]&gt; &lt;list&gt;      &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_bennin~ [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss   [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg   [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbe~ [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson  [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon  [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows, and 2 more variables: anomaly_days_mean &lt;list&gt;,
## #   anomaly_days_max &lt;list&gt;</code></pre>
<pre class="r"><code>nldas_climatology$anomaly_days_max[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 10
##     year days_tmp_max_gt~ days_tmp_max_gt~ days_tmp_max_gt~ days_heat_index~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               78               53               37               73
##  2  1991               57               32               20               64
##  3  1992               30               13                7               20
##  4  1993               36               23               12               28
##  5  1994               41               24               11               40
##  6  1995               63               30               15               59
##  7  1996               63               32               17               57
##  8  1997               40               19               13               45
##  9  1998              101               67               43               93
## 10  1999               70               45               38               63
## # ... with 19 more rows, and 5 more variables:
## #   days_heat_index_max_gt90pct &lt;int&gt;, days_heat_index_max_gt95pct &lt;int&gt;,
## #   days_wbgt_max_gt85pct &lt;int&gt;, days_wbgt_max_gt90pct &lt;int&gt;,
## #   days_wbgt_max_gt95pct &lt;int&gt;</code></pre>
</div>
<div id="days-max-temperature-index-above-1-or-2-standard-deviations-of-max-daily-temperature-climate-normal" class="section level3">
<h3>Days max temperature index above 1 or 2 Standard Deviation(s) of max daily temperature climate normal</h3>
<pre class="r"><code># Single installation

left_join(

(left_join(
nldas_climatology$data[[1]] %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(max = &quot;max&quot;)) %&gt;%
    mutate(month = month(date),
           day = day(date)),

nldas_climatology$data[[1]] %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(max = &quot;max&quot;)) %&gt;%
    mutate(month = month(date),
           day = day(date)) %&gt;% 
  group_by(month, day) %&gt;% 
     summarise(mean_tmp_f_max = mean(tmp_f_max),
               mean_heat_index_max = mean(heat_index_max),
               mean_wbgt_f_max = mean(wbgt_f_max)),
 by = c(&quot;month&quot;, &quot;day&quot;))
),

(left_join(
      nldas_climatology$data[[1]]  %&gt;% 
      group_by(date = date(local_dttm)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f, heat_index, wbgt_f),
            .funs = c(max = &quot;max&quot;)) %&gt;% 
        mutate(month = month(date), day = day(date)), 
      
      nldas_climatology$data[[1]] %&gt;% 
      group_by(date = date(local_dttm)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f, heat_index, wbgt_f),
            .funs = c(max = &quot;max&quot;)) %&gt;% 
    group_by(month = month(date), day = day(date)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f_max, heat_index_max, wbgt_f_max),
            funs(sd = sd)),
    by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
    dplyr::select(month:wbgt_f_max_sd)
 ),

by = c(&quot;month&quot; = &quot;month&quot;, &quot;day&quot; = &quot;day&quot;)) %&gt;%
  dplyr::distinct() %&gt;% 

  group_by(year = lubridate::year(date)) %&gt;% 
      dplyr::summarise(
        days_tmp_max_gt1sd = sum(tmp_f_max &gt; (mean_tmp_f_max + tmp_f_max_sd)), 
        days_heat_index_max_gt1sd = sum(heat_index_max &gt; (mean_heat_index_max + heat_index_max_sd)),
        days_wbgt_max_gt1sd = sum(wbgt_f_max &gt; (mean_wbgt_f_max + wbgt_f_max_sd)),
        days_tmp_max_gt2sd = sum(tmp_f_max &gt; (mean_tmp_f_max + 2 * tmp_f_max_sd)), 
        days_heat_index_max_gt2sd = sum(heat_index_max &gt; (mean_heat_index_max + 2 * heat_index_max_sd)),
        days_wbgt_max_gt2sd = sum(wbgt_f_max &gt; (mean_wbgt_f_max + 2 * wbgt_f_max_sd)))</code></pre>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once per session.</code></pre>
<pre><code>## # A tibble: 29 x 7
##     year days_tmp_max_gt~ days_heat_index~ days_wbgt_max_g~ days_tmp_max_gt~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               74               68               65                2
##  2  1991               50               51               45                0
##  3  1992               26               20               30                0
##  4  1993               37               27               34                1
##  5  1994               35               37               47                0
##  6  1995               50               50               43                3
##  7  1996               49               53               42                2
##  8  1997               33               40               48                1
##  9  1998               89               89               52                2
## 10  1999               65               57               58                4
## # ... with 19 more rows, and 2 more variables: days_heat_index_max_gt2sd &lt;int&gt;,
## #   days_wbgt_max_gt2sd &lt;int&gt;</code></pre>
<pre class="r"><code># Function: daily max standard dev anomalies

sd_days_max_function &lt;- function(data) {
  left_join(
    (left_join(
    data %&gt;% 
      mutate(date = as.Date(local_dttm)) %&gt;% 
      group_by(date) %&gt;% # daily aggregates
        dplyr::summarise_at(
              .vars = vars(tmp_f, heat_index, wbgt_f),
              .funs = c(max = &quot;max&quot;)) %&gt;%
        mutate(month = month(date),
               day = day(date)),
    
    data %&gt;% 
      mutate(date = as.Date(local_dttm)) %&gt;% 
      group_by(date) %&gt;% # daily aggregates
        dplyr::summarise_at(
              .vars = vars(tmp_f, heat_index, wbgt_f),
              .funs = c(max = &quot;max&quot;)) %&gt;%
        mutate(month = month(date),
               day = day(date)) %&gt;% 
      group_by(month, day) %&gt;% 
         summarise(mean_tmp_f_max = mean(tmp_f_max),
                   mean_heat_index_max = mean(heat_index_max),
                   mean_wbgt_f_max = mean(wbgt_f_max)),
     by = c(&quot;month&quot;, &quot;day&quot;))
    ),
    
    (left_join(
          data  %&gt;% 
          group_by(date = date(local_dttm)) %&gt;% 
          dplyr::summarise_at(
                .vars = vars(tmp_f, heat_index, wbgt_f),
                .funs = c(max = &quot;max&quot;)) %&gt;% 
            mutate(month = month(date), day = day(date)), 
          
          nldas_climatology$data[[1]] %&gt;% 
          group_by(date = date(local_dttm)) %&gt;% 
          dplyr::summarise_at(
                .vars = vars(tmp_f, heat_index, wbgt_f),
                .funs = c(max = &quot;max&quot;)) %&gt;% 
        group_by(month = month(date), day = day(date)) %&gt;% 
          dplyr::summarise_at(
                .vars = vars(tmp_f_max, heat_index_max, wbgt_f_max),
                funs(sd = sd)),
        by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
        dplyr::select(month:wbgt_f_max_sd)
     ),
    
    by = c(&quot;month&quot; = &quot;month&quot;, &quot;day&quot; = &quot;day&quot;)) %&gt;%
      dplyr::distinct() %&gt;% 
    
      group_by(year = lubridate::year(date)) %&gt;% 
          dplyr::summarise(
            days_tmp_max_gt1sd = sum(tmp_f_max &gt; (mean_tmp_f_max + tmp_f_max_sd)), 
            days_heat_index_max_gt1sd = sum(heat_index_max &gt; (mean_heat_index_max + heat_index_max_sd)),
            days_wbgt_max_gt1sd = sum(wbgt_f_max &gt; (mean_wbgt_f_max + wbgt_f_max_sd)),
            days_tmp_max_gt2sd = sum(tmp_f_max &gt; (mean_tmp_f_max + 2 * tmp_f_max_sd)), 
            days_heat_index_max_gt2sd = sum(heat_index_max &gt; (mean_heat_index_max + 2 * heat_index_max_sd)),
            days_wbgt_max_gt2sd = sum(wbgt_f_max &gt; (mean_wbgt_f_max + 2 * wbgt_f_max_sd)))
}
  
 

nldas_climatology &lt;-
  nldas_climatology %&gt;% 
    mutate(sd_days_max =
        map(.x = nldas_climatology$data, .f = sd_days_max_function))


nldas_climatology</code></pre>
<pre><code>## # A tibble: 25 x 8
##    installation          data climatology anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;        &lt;list&lt;df[,6]&gt; &lt;list&gt;      &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_bennin~ [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss   [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg   [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbe~ [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson  [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon  [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows, and 3 more variables: anomaly_days_mean &lt;list&gt;,
## #   anomaly_days_max &lt;list&gt;, sd_days_max &lt;list&gt;</code></pre>
<pre class="r"><code>nldas_climatology$sd_days_max[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 7
##     year days_tmp_max_gt~ days_heat_index~ days_wbgt_max_g~ days_tmp_max_gt~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               74               68               65                2
##  2  1991               50               51               45                0
##  3  1992               26               20               30                0
##  4  1993               37               27               34                1
##  5  1994               35               37               47                0
##  6  1995               50               50               43                3
##  7  1996               49               53               42                2
##  8  1997               33               40               48                1
##  9  1998               89               89               52                2
## 10  1999               65               57               58                4
## # ... with 19 more rows, and 2 more variables: days_heat_index_max_gt2sd &lt;int&gt;,
## #   days_wbgt_max_gt2sd &lt;int&gt;</code></pre>
</div>
<div id="days-mean-temperature-index-above-1-or-2-standard-deviations-of-mean-daily-temperature-climate-normal" class="section level3">
<h3>Days mean temperature index above 1 or 2 Standard Deviation(s) of mean daily temperature climate normal</h3>
<pre class="r"><code># Single installation

left_join(

(left_join(
nldas_climatology$data[[1]] %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(mean = &quot;mean&quot;)) %&gt;%
    mutate(month = month(date),
           day = day(date)),

nldas_climatology$data[[1]] %&gt;% 
  mutate(date = as.Date(local_dttm)) %&gt;% 
  group_by(date) %&gt;% # daily aggregates
    dplyr::summarise_at(
          .vars = vars(tmp_f, heat_index, wbgt_f),
          .funs = c(mean = &quot;mean&quot;)) %&gt;%
    mutate(month = month(date),
           day = day(date)) %&gt;% 
  group_by(month, day) %&gt;% 
     summarise(mean_tmp_f_mean = mean(tmp_f_mean),
               mean_heat_index_mean = mean(heat_index_mean),
               mean_wbgt_f_mean = mean(wbgt_f_mean)),
 by = c(&quot;month&quot;, &quot;day&quot;))
),

(left_join(
      nldas_climatology$data[[1]]  %&gt;% 
      group_by(date = date(local_dttm)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f, heat_index, wbgt_f),
            .funs = c(max = &quot;mean&quot;)) %&gt;% 
        mutate(month = month(date), day = day(date)), 
      
      nldas_climatology$data[[1]] %&gt;% 
      group_by(date = date(local_dttm)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f, heat_index, wbgt_f),
            .funs = c(mean = &quot;mean&quot;)) %&gt;% 
    group_by(month = month(date), day = day(date)) %&gt;% 
      dplyr::summarise_at(
            .vars = vars(tmp_f_mean, heat_index_mean, wbgt_f_mean),
            funs(sd = sd)),
    by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
    dplyr::select(month:wbgt_f_mean_sd)
 ),

by = c(&quot;month&quot; = &quot;month&quot;, &quot;day&quot; = &quot;day&quot;)) %&gt;%
  dplyr::distinct() %&gt;% 

  group_by(year = lubridate::year(date)) %&gt;% 
      dplyr::summarise(
        days_tmp_mean_gt1sd = sum(tmp_f_mean &gt; (mean_tmp_f_mean + tmp_f_mean_sd)), 
        days_heat_index_mean_gt1sd = sum(heat_index_mean &gt; (mean_heat_index_mean + heat_index_mean_sd)),
        days_wbgt_mean_gt1sd = sum(wbgt_f_mean &gt; (mean_wbgt_f_mean + wbgt_f_mean_sd)),
        days_tmp_mean_gt2sd = sum(tmp_f_mean &gt; (mean_tmp_f_mean + 2 * tmp_f_mean_sd)), 
        days_heat_index_mean_gt2sd = sum(heat_index_mean &gt; (mean_heat_index_mean + 2 * heat_index_mean_sd)),
        days_wbgt_mean_gt2sd = sum(wbgt_f_mean &gt; (mean_wbgt_f_mean + 2 * wbgt_f_mean_sd)))</code></pre>
<pre><code>## # A tibble: 29 x 7
##     year days_tmp_mean_g~ days_heat_index~ days_wbgt_mean_~ days_tmp_mean_g~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               54               53               45                1
##  2  1991               63               68               62                0
##  3  1992               30               24               25                0
##  4  1993               37               35               34                0
##  5  1994               49               45               43                0
##  6  1995               54               58               53                3
##  7  1996               49               46               44                3
##  8  1997               47               49               45                2
##  9  1998               85               86               73                2
## 10  1999               58               57               53                2
## # ... with 19 more rows, and 2 more variables:
## #   days_heat_index_mean_gt2sd &lt;int&gt;, days_wbgt_mean_gt2sd &lt;int&gt;</code></pre>
<pre class="r"><code># Function: daily mean standard dev anomalies

sd_days_mean_function &lt;- function(data) {
  left_join(

    (left_join(
        data %&gt;% 
          mutate(date = as.Date(local_dttm)) %&gt;% 
          group_by(date) %&gt;% # daily aggregates
            dplyr::summarise_at(
                  .vars = vars(tmp_f, heat_index, wbgt_f),
                  .funs = c(mean = &quot;mean&quot;)) %&gt;%
            mutate(month = month(date),
                   day = day(date)),
        
        data %&gt;% 
          mutate(date = as.Date(local_dttm)) %&gt;% 
          group_by(date) %&gt;% # daily aggregates
            dplyr::summarise_at(
                  .vars = vars(tmp_f, heat_index, wbgt_f),
                  .funs = c(mean = &quot;mean&quot;)) %&gt;%
            mutate(month = month(date),
                   day = day(date)) %&gt;% 
          group_by(month, day) %&gt;% 
             summarise(mean_tmp_f_mean = mean(tmp_f_mean),
                       mean_heat_index_mean = mean(heat_index_mean),
                       mean_wbgt_f_mean = mean(wbgt_f_mean)),
         by = c(&quot;month&quot;, &quot;day&quot;))
    ),
    
    (left_join(
          data  %&gt;% 
          group_by(date = date(local_dttm)) %&gt;% 
          dplyr::summarise_at(
                .vars = vars(tmp_f, heat_index, wbgt_f),
                .funs = c(max = &quot;mean&quot;)) %&gt;% 
            mutate(month = month(date), day = day(date)), 
          
          nldas_climatology$data[[1]] %&gt;% 
          group_by(date = date(local_dttm)) %&gt;% 
          dplyr::summarise_at(
                .vars = vars(tmp_f, heat_index, wbgt_f),
                .funs = c(mean = &quot;mean&quot;)) %&gt;% 
        group_by(month = month(date), day = day(date)) %&gt;% 
          dplyr::summarise_at(
                .vars = vars(tmp_f_mean, heat_index_mean, wbgt_f_mean),
                funs(sd = sd)),
        by = c(&quot;month&quot;, &quot;day&quot;)) %&gt;% 
        dplyr::select(month:wbgt_f_mean_sd)
     ),
    
    by = c(&quot;month&quot; = &quot;month&quot;, &quot;day&quot; = &quot;day&quot;)) %&gt;%
  dplyr::distinct() %&gt;% 

  group_by(year = lubridate::year(date)) %&gt;% 
      dplyr::summarise(
        days_tmp_mean_gt1sd = sum(tmp_f_mean &gt; (mean_tmp_f_mean + tmp_f_mean_sd)), 
        days_heat_index_mean_gt1sd = sum(heat_index_mean &gt; (mean_heat_index_mean + heat_index_mean_sd)),
        days_wbgt_mean_gt1sd = sum(wbgt_f_mean &gt; (mean_wbgt_f_mean + wbgt_f_mean_sd)),
        days_tmp_mean_gt2sd = sum(tmp_f_mean &gt; (mean_tmp_f_mean + 2 * tmp_f_mean_sd)), 
        days_heat_index_mean_gt2sd = sum(heat_index_mean &gt; (mean_heat_index_mean + 2 * heat_index_mean_sd)),
        days_wbgt_mean_gt2sd = sum(wbgt_f_mean &gt; (mean_wbgt_f_mean + 2 * wbgt_f_mean_sd)))
}
  
 

nldas_climatology &lt;-
  nldas_climatology %&gt;% 
    mutate(sd_days_mean =
        map(.x = nldas_climatology$data, .f = sd_days_mean_function))


nldas_climatology</code></pre>
<pre><code>## # A tibble: 25 x 9
##    installation          data climatology anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;        &lt;list&lt;df[,6]&gt; &lt;list&gt;      &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_bennin~ [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss   [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg   [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbe~ [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson  [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon  [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood    [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson [254,208 x 6] &lt;tibble [3~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows, and 4 more variables: anomaly_days_mean &lt;list&gt;,
## #   anomaly_days_max &lt;list&gt;, sd_days_max &lt;list&gt;, sd_days_mean &lt;list&gt;</code></pre>
<pre class="r"><code>nldas_climatology$sd_days_mean[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 7
##     year days_tmp_mean_g~ days_heat_index~ days_wbgt_mean_~ days_tmp_mean_g~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               54               53               45                1
##  2  1991               63               68               62                0
##  3  1992               30               24               25                0
##  4  1993               37               35               34                0
##  5  1994               49               45               43                0
##  6  1995               54               58               53                3
##  7  1996               49               46               44                3
##  8  1997               47               49               45                2
##  9  1998               85               86               73                2
## 10  1999               58               57               53                2
## # ... with 19 more rows, and 2 more variables:
## #   days_heat_index_mean_gt2sd &lt;int&gt;, days_wbgt_mean_gt2sd &lt;int&gt;</code></pre>
<pre class="r"><code># write_rds(nldas_climatology, &quot;data/nldas_climatology.rds&quot;)</code></pre>
</div>
</div>
<div id="heat-season-anomalies" class="section level2">
<h2>“Heat season” Anomalies</h2>
<p>For purposes of training guidance, summer ‘heat season’ is routinely defined as 1 May through 30 September (APHC, Public Health Report No. WS.0022479-15, APG, MD, June 2015).</p>
<div id="filter-may-sep-data-and-climatology" class="section level3">
<h3>Filter MAY-SEP Data and Climatology</h3>
<p>Maximum daily temperature/index compared to the mean of the maximum daily temperatures on the same day of year over the climatology period during the “heat season”.</p>
<pre class="r"><code>nldas_climatology_summer &lt;-
  nldas_climatology %&gt;%
    mutate(summer_data =
             map(data, ~ filter(., month %in% 5:9))) %&gt;%
    mutate(summer_climatology =
             map(climatology, ~ filter(., month %in% 5:9))) %&gt;% 
    dplyr::select(installation, summer_data, summer_climatology)</code></pre>
</div>
<div id="may-sep-daily-anomaly-mean" class="section level3">
<h3>MAY-SEP Daily anomaly (mean)</h3>
<p>Mean daily temperature/index compared to the mean of the temperatures over the climatology period on the same day of year.</p>
<pre class="r"><code>nldas_climatology_summer &lt;-
  nldas_climatology_summer %&gt;% 
    mutate(anomaly_daily_mean_may_sep =
        map2(.x = nldas_climatology_summer$summer_data, .y = nldas_climatology_summer$summer_climatology, .f = anomaly_daily_mean_function))

nldas_climatology_summer</code></pre>
<pre><code>## # A tibble: 25 x 4
##    installation    summer_data        summer_climatology anomaly_daily_mean_may~
##    &lt;chr&gt;           &lt;list&gt;             &lt;list&gt;             &lt;list&gt;                 
##  1 eglin_afb       &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
##  2 fort_benning_ga &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
##  3 fort_bliss      &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
##  4 fort_bragg      &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
##  5 fort_campbell   &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
##  6 fort_carson     &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
##  7 fort_drum       &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
##  8 fort_gordon     &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
##  9 fort_hood       &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
## 10 fort_jackson    &lt;tibble [106,488 ~ &lt;tibble [153 x 24~ &lt;tibble [29 x 4]&gt;      
## # ... with 15 more rows</code></pre>
<pre class="r"><code>nldas_climatology_summer$anomaly_daily_mean_may_sep[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 4
##     year tmp_f_mean_anomaly_me~ heat_index_mean_anomaly_~ wbgt_f_mean_anomaly_m~
##    &lt;dbl&gt;                  &lt;dbl&gt;                     &lt;dbl&gt;                  &lt;dbl&gt;
##  1  1990                  0.298                     0.197                 0.0476
##  2  1991                  0.273                     0.197                 0.145 
##  3  1992                 -0.900                    -1.81                 -1.18  
##  4  1993                  0.200                     0.175                -0.161 
##  5  1994                 -1.02                     -2.22                 -1.07  
##  6  1995                  0.537                     0.570                 0.184 
##  7  1996                  0.247                    -0.211                -0.132 
##  8  1997                 -0.781                    -1.08                 -0.826 
##  9  1998                  1.43                      2.34                  1.21  
## 10  1999                 -0.213                    -0.448                -0.623 
## # ... with 19 more rows</code></pre>
</div>
<div id="may-sep-daily-anomaly-maximum" class="section level3">
<h3>MAY-SEP Daily anomaly (maximum)</h3>
<pre class="r"><code>nldas_climatology_summer &lt;-
  nldas_climatology_summer %&gt;% 
    mutate(anomaly_daily_max_may_sep =
        map(.x = nldas_climatology_summer$summer_data, .f = anomaly_daily_max_function))

nldas_climatology_summer</code></pre>
<pre><code>## # A tibble: 25 x 5
##    installation  summer_data  summer_climatol~ anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;         &lt;list&gt;       &lt;list&gt;           &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb     &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_benning~ &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss    &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg    &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbell &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson   &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum     &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon   &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood     &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson  &lt;tibble [10~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows</code></pre>
<pre class="r"><code>nldas_climatology_summer$anomaly_daily_max_may_sep[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 4
##     year tmp_f_max_anomaly_mean heat_index_max_anomaly_m~ wbgt_f_max_anomaly_me~
##    &lt;dbl&gt;                  &lt;dbl&gt;                     &lt;dbl&gt;                  &lt;dbl&gt;
##  1  1990                  0.705                     0.506                 0.530 
##  2  1991                 -0.551                    -0.677                -0.419 
##  3  1992                 -1.01                     -2.26                 -1.31  
##  4  1993                  0.244                    -0.331                -0.302 
##  5  1994                 -1.67                     -2.86                 -1.48  
##  6  1995                  0.554                     0.332                -0.0471
##  7  1996                  0.211                    -0.596                -0.0890
##  8  1997                 -1.42                     -2.01                 -0.842 
##  9  1998                  1.89                      2.83                  0.641 
## 10  1999                 -0.254                    -0.749                -0.535 
## # ... with 19 more rows</code></pre>
</div>
<div id="may-sep-days-mean-temperature-index-above-climate-normal-percentile-averaged-over-all-hours-of-day" class="section level3">
<h3>MAY-SEP Days mean temperature index above climate normal percentile (averaged over all hours of day)</h3>
<pre class="r"><code>nldas_climatology_summer &lt;-
  nldas_climatology_summer %&gt;% 
    mutate(anomaly_days_mean_may_sep =
        map2(.x = nldas_climatology_summer$summer_data, .y = nldas_climatology_summer$summer_climatology, .f = anomaly_days_function))

nldas_climatology_summer</code></pre>
<pre><code>## # A tibble: 25 x 6
##    installation summer_data summer_climatol~ anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;        &lt;list&gt;      &lt;list&gt;           &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_bennin~ &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss   &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg   &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbe~ &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson  &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon  &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows, and 1 more variable: anomaly_days_mean_may_sep &lt;list&gt;</code></pre>
<pre class="r"><code>nldas_climatology_summer$anomaly_days_mean_may_sep[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 10
##     year days_tmp_gt85pct days_tmp_gt90pct days_tmp_gt95pct days_heat_index~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990                0                0                0                3
##  2  1991                0                0                0                3
##  3  1992                0                0                0                0
##  4  1993                0                0                0                2
##  5  1994                0                0                0                0
##  6  1995                1                0                0                4
##  7  1996                0                0                0                4
##  8  1997                1                1                0                4
##  9  1998                0                0                0                6
## 10  1999                3                0                0                7
## # ... with 19 more rows, and 5 more variables: days_heat_index_gt90pct &lt;int&gt;,
## #   days_heat_index_gt95pct &lt;int&gt;, days_wbgt_gt85pct &lt;int&gt;,
## #   days_wbgt_gt90pct &lt;int&gt;, days_wbgt_gt95pct &lt;int&gt;</code></pre>
</div>
<div id="may-sep-days-max-temperature-index-above-max-daily-climate-normal-percentile" class="section level3">
<h3>MAY-SEP Days max temperature index above max daily climate normal percentile</h3>
<pre class="r"><code>nldas_climatology_summer &lt;-
  nldas_climatology_summer %&gt;% 
    mutate(anomaly_days_max_may_sep =
        map(.x = nldas_climatology_summer$summer_data, .f = anomaly_days_max_function))


nldas_climatology_summer</code></pre>
<pre><code>## # A tibble: 25 x 7
##    installation summer_data summer_climatol~ anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;        &lt;list&gt;      &lt;list&gt;           &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_bennin~ &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss   &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg   &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbe~ &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson  &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon  &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows, and 2 more variables:
## #   anomaly_days_mean_may_sep &lt;list&gt;, anomaly_days_max_may_sep &lt;list&gt;</code></pre>
<pre class="r"><code>nldas_climatology_summer$anomaly_days_max_may_sep[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 10
##     year days_tmp_max_gt~ days_tmp_max_gt~ days_tmp_max_gt~ days_heat_index~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               30               17               13               26
##  2  1991               16                8                5               20
##  3  1992                9                7                3                5
##  4  1993               21               14                7               15
##  5  1994                7                3                1                5
##  6  1995               40               20               11               31
##  7  1996               26               12                7               19
##  8  1997               10                6                3               15
##  9  1998               61               44               28               52
## 10  1999               20               10                7               17
## # ... with 19 more rows, and 5 more variables:
## #   days_heat_index_max_gt90pct &lt;int&gt;, days_heat_index_max_gt95pct &lt;int&gt;,
## #   days_wbgt_max_gt85pct &lt;int&gt;, days_wbgt_max_gt90pct &lt;int&gt;,
## #   days_wbgt_max_gt95pct &lt;int&gt;</code></pre>
</div>
<div id="may-sep-days-max-temperature-index-above-1-or-2-standard-deviations-of-max-daily-temperature-climate-normal" class="section level3">
<h3>MAY-SEP Days max temperature index above 1 or 2 Standard Deviation(s) of max daily temperature climate normal</h3>
<pre class="r"><code>nldas_climatology_summer &lt;-
  nldas_climatology_summer %&gt;% 
    mutate(sd_days_max_may_sep =
        map(.x = nldas_climatology_summer$summer_data, .f = sd_days_max_function))


nldas_climatology_summer</code></pre>
<pre><code>## # A tibble: 25 x 8
##    installation summer_data summer_climatol~ anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;        &lt;list&gt;      &lt;list&gt;           &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_bennin~ &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss   &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg   &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbe~ &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson  &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon  &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows, and 3 more variables:
## #   anomaly_days_mean_may_sep &lt;list&gt;, anomaly_days_max_may_sep &lt;list&gt;,
## #   sd_days_max_may_sep &lt;list&gt;</code></pre>
<pre class="r"><code>nldas_climatology_summer$sd_days_max_may_sep[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 7
##     year days_tmp_max_gt~ days_heat_index~ days_wbgt_max_g~ days_tmp_max_gt~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               29               24               19                2
##  2  1991               10               14               16                0
##  3  1992                9                6               11                0
##  4  1993               21               14               20                1
##  5  1994                3                6               15                0
##  6  1995               30               24               22                3
##  7  1996               18               20               14                2
##  8  1997                9               14               22                1
##  9  1998               52               54               19                2
## 10  1999               16               15               20                3
## # ... with 19 more rows, and 2 more variables: days_heat_index_max_gt2sd &lt;int&gt;,
## #   days_wbgt_max_gt2sd &lt;int&gt;</code></pre>
</div>
<div id="may-sep-days-mean-temperature-index-above-1-or-2-standard-deviations-of-mean-daily-temperature-climate-normal" class="section level3">
<h3>MAY-SEP Days mean temperature index above 1 or 2 Standard Deviation(s) of mean daily temperature climate normal</h3>
<pre class="r"><code>nldas_climatology_summer &lt;-
  nldas_climatology_summer %&gt;% 
    mutate(sd_days_mean_may_sep =
        map(.x = nldas_climatology_summer$summer_data, .f = sd_days_mean_function))


nldas_climatology_summer</code></pre>
<pre><code>## # A tibble: 25 x 9
##    installation summer_data summer_climatol~ anomaly_daily_m~ anomaly_daily_m~
##    &lt;chr&gt;        &lt;list&gt;      &lt;list&gt;           &lt;list&gt;           &lt;list&gt;          
##  1 eglin_afb    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  2 fort_bennin~ &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  3 fort_bliss   &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  4 fort_bragg   &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  5 fort_campbe~ &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  6 fort_carson  &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  7 fort_drum    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  8 fort_gordon  &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
##  9 fort_hood    &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## 10 fort_jackson &lt;tibble [1~ &lt;tibble [153 x ~ &lt;tibble [29 x 4~ &lt;tibble [29 x 4~
## # ... with 15 more rows, and 4 more variables:
## #   anomaly_days_mean_may_sep &lt;list&gt;, anomaly_days_max_may_sep &lt;list&gt;,
## #   sd_days_max_may_sep &lt;list&gt;, sd_days_mean_may_sep &lt;list&gt;</code></pre>
<pre class="r"><code>nldas_climatology_summer$sd_days_mean_may_sep[1]</code></pre>
<pre><code>## [[1]]
## # A tibble: 29 x 7
##     year days_tmp_mean_g~ days_heat_index~ days_wbgt_mean_~ days_tmp_mean_g~
##    &lt;dbl&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1  1990               19               18               12                1
##  2  1991               19               23               20                0
##  3  1992               10                5                5                0
##  4  1993               22               18               19                0
##  5  1994                8                7                8                0
##  6  1995               26               29               25                3
##  7  1996               20               17               14                3
##  8  1997               13               15               12                2
##  9  1998               51               50               37                2
## 10  1999               16               16               14                2
## # ... with 19 more rows, and 2 more variables:
## #   days_heat_index_mean_gt2sd &lt;int&gt;, days_wbgt_mean_gt2sd &lt;int&gt;</code></pre>
<pre class="r"><code># write_rds(nldas_climatology_summer, &quot;data/nldas_climatology_summer.rds&quot;)

names(nldas_climatology)</code></pre>
<pre><code>## [1] &quot;installation&quot;       &quot;data&quot;               &quot;climatology&quot;       
## [4] &quot;anomaly_daily_mean&quot; &quot;anomaly_daily_max&quot;  &quot;anomaly_days_mean&quot; 
## [7] &quot;anomaly_days_max&quot;   &quot;sd_days_max&quot;        &quot;sd_days_mean&quot;</code></pre>
<pre class="r"><code>names(nldas_climatology_summer)</code></pre>
<pre><code>## [1] &quot;installation&quot;               &quot;summer_data&quot;               
## [3] &quot;summer_climatology&quot;         &quot;anomaly_daily_mean_may_sep&quot;
## [5] &quot;anomaly_daily_max_may_sep&quot;  &quot;anomaly_days_mean_may_sep&quot; 
## [7] &quot;anomaly_days_max_may_sep&quot;   &quot;sd_days_max_may_sep&quot;       
## [9] &quot;sd_days_mean_may_sep&quot;</code></pre>
</div>
</div>
<div id="daily-anomaly-plots" class="section level2">
<h2>Daily anomaly plots</h2>
<div id="days-with-mean-temperature-exceeding-percentiles" class="section level3">
<h3>Days with mean temperature exceeding percentiles</h3>
<pre class="r"><code>nldas_climatology$anomaly_days_mean[[1]] %&gt;% 
  gather(key = &quot;metric&quot;, value = &quot;num_days&quot;, days_tmp_gt85pct:days_wbgt_gt90pct) %&gt;% 
  ggplot(aes(x = year, y = num_days, color = metric)) +
    geom_point() +
    geom_line() +
    labs(
      title = &quot;Eglin AFB Anomaly Days - mean temperatures&quot;,
      x = &quot;Year&quot;,
      y = &quot;Number of Days Exceeding Percentile&quot;
    ) +
    theme(legend.position = &quot;bottom&quot;) +
    theme_bw()</code></pre>
<p><img src="climatology_files/figure-html/anomaly_day_plot-1.png" width="672" /></p>
<pre class="r"><code>nldas_climatology$anomaly_days_mean[[1]] %&gt;% 
  gather(key = &quot;metric&quot;, value = &quot;num_days&quot;, days_tmp_gt85pct:days_wbgt_gt90pct) %&gt;% 
  ggplot(aes(x = year, y = num_days, color = metric)) +
    geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
    labs(
      title = &quot;Eglin AFB Anomaly Days - mean temperatures&quot;,
      x = &quot;Year&quot;,
      y = &quot;Number of Days Exceeding Percentile&quot;
    ) +
    theme_bw()  </code></pre>
<p><img src="climatology_files/figure-html/anomaly_day_plot-2.png" width="672" /></p>
</div>
<div id="days-with-maximum-temperature-exceeding-maximum-daily-percentiles" class="section level3">
<h3>Days with maximum temperature exceeding maximum daily percentiles</h3>
<pre class="r"><code>nldas_climatology$anomaly_days_max[[1]] %&gt;% 
  gather(key = &quot;metric&quot;, value = &quot;num_days&quot;, days_tmp_max_gt85pct:days_wbgt_max_gt90pct) %&gt;% 
  ggplot(aes(x = year, y = num_days, color = metric)) +
    geom_point() +
    geom_line() +
    labs(
      title = &quot;Eglin AFB Anomaly Days - maximum temperatures&quot;,
      x = &quot;Year&quot;,
      y = &quot;Number of Days Exceeding Percentile&quot;
    ) +
    theme(legend.position = &quot;bottom&quot;) +
    theme_bw()</code></pre>
<p><img src="climatology_files/figure-html/anomaly_day_max_plot-1.png" width="672" /></p>
<pre class="r"><code>nldas_climatology$anomaly_days_max[[1]] %&gt;% 
  gather(key = &quot;metric&quot;, value = &quot;num_days&quot;, days_tmp_max_gt85pct:days_wbgt_max_gt90pct) %&gt;% 
  ggplot(aes(x = year, y = num_days, color = metric)) +
    geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
    labs(
      title = &quot;Eglin AFB Anomaly Days - maximum temperatures&quot;,
      x = &quot;Year&quot;,
      y = &quot;Number of Days Exceeding Percentile&quot;
    ) +
    theme_bw()  </code></pre>
<p><img src="climatology_files/figure-html/anomaly_day_max_plot-2.png" width="672" /></p>
</div>
</div>
<div id="plot-climatologies" class="section level2">
<h2>Plot climatologies</h2>
<div id="single-plot" class="section level3">
<h3>Single plot</h3>
<pre class="r"><code>nldas_climatology$climatology[[1]] %&gt;%
    ungroup() %&gt;% 
    dplyr::select(-c(month, day, tmp_f_sd, heat_index_sd, wbgt_f_sd)) %&gt;%
    mutate(mon_day = paste0(&quot;2019&quot;, &quot;-&quot;, mon_day),
           mon_day = as.Date(mon_day)) %&gt;% 
    gather(., key = &quot;variable&quot;, value = &quot;value&quot;, tmp_f_mean:`wbgt_f_95%`) %&gt;% 
    na.omit(mon_day) %&gt;%   # Feb 29 coded as NA &quot;leap year&quot;
    filter(variable == c(&quot;wbgt_f_max&quot;, &quot;wbgt_f_mean&quot;, &quot;wbgt_f_min&quot;, &quot;wbgt_f_85%&quot;, &quot;wbgt_f_90%&quot;, &quot;wbgt_f_95%&quot;)) %&gt;% 
    ggplot(aes(x = mon_day, y = value, color = variable)) + 
    geom_smooth(alpha = 0.1) +
    geom_point() +
    scale_x_date(labels = date_format(&quot;%b-%d&quot;),
               breaks = date_breaks(&quot;months&quot;)) +
    labs(
      title = &quot;Eglin AFB WBGT Climatology&quot;,
      x = &quot;Month-Day of Year&quot;,
      y = &quot;WBGT (°F)&quot;
    ) +
    theme(legend.position = &quot;bottom&quot;) +
    theme_bw()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatology_single-1.png" width="672" /></p>
</div>
<div id="all-plots" class="section level3">
<h3>All plots</h3>
<pre class="r"><code># Plot function
climatology_plot &lt;- function(df) {
  df %&gt;%
    ungroup() %&gt;% 
    dplyr::select(-c(month, day, tmp_f_sd, heat_index_sd, wbgt_f_sd)) %&gt;%
    mutate(mon_day = paste0(&quot;2019&quot;, &quot;-&quot;, mon_day),
           mon_day = as.Date(mon_day)) %&gt;% 
    gather(., key = &quot;variable&quot;, value = &quot;value&quot;, tmp_f_mean:`wbgt_f_95%`) %&gt;% 
    na.omit(mon_day) %&gt;%   # Feb 29 coded as NA &quot;leap year&quot;
    filter(variable == c(&quot;wbgt_f_max&quot;, &quot;wbgt_f_mean&quot;, &quot;wbgt_f_min&quot;, &quot;wbgt_f_85%&quot;, &quot;wbgt_f_90%&quot;, &quot;wbgt_f_95%&quot;)) %&gt;% 
    ggplot(aes(x = mon_day, y = value, color = variable)) + 
    geom_smooth(alpha = 0.1) +
    geom_point() +
    scale_x_date(labels = date_format(&quot;%b-%d&quot;),
               breaks = date_breaks(&quot;months&quot;)) +
    labs(
      title = &quot;WBGT Climatology&quot;,
      x = &quot;Month-Day of Year&quot;,
      y = &quot;WBGT (°F)&quot;
    ) +
    theme(legend.position = &quot;bottom&quot;) +
    theme_bw()
}

# Map plot function over list

names(nldas_climatology$climatology) &lt;- nldas_climatology$installation
  

map(nldas_climatology$climatology, climatology_plot)</code></pre>
<pre><code>## $eglin_afb</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-1.png" width="672" /></p>
<pre><code>## 
## $fort_benning_ga</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-2.png" width="672" /></p>
<pre><code>## 
## $fort_bliss</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-3.png" width="672" /></p>
<pre><code>## 
## $fort_bragg</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-4.png" width="672" /></p>
<pre><code>## 
## $fort_campbell</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-5.png" width="672" /></p>
<pre><code>## 
## $fort_carson</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-6.png" width="672" /></p>
<pre><code>## 
## $fort_drum</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-7.png" width="672" /></p>
<pre><code>## 
## $fort_gordon</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-8.png" width="672" /></p>
<pre><code>## 
## $fort_hood</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-9.png" width="672" /></p>
<pre><code>## 
## $fort_jackson</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-10.png" width="672" /></p>
<pre><code>## 
## $fort_leonard_wood</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-11.png" width="672" /></p>
<pre><code>## 
## $fort_lewis</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-12.png" width="672" /></p>
<pre><code>## 
## $fort_polk</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-13.png" width="672" /></p>
<pre><code>## 
## $fort_riley</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-14.png" width="672" /></p>
<pre><code>## 
## $fort_sam_houston</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-15.png" width="672" /></p>
<pre><code>## 
## $fort_sill</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-16.png" width="672" /></p>
<pre><code>## 
## $fort_stewart</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-17.png" width="672" /></p>
<pre><code>## 
## $lackland_afb</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-18.png" width="672" /></p>
<pre><code>## 
## $mcb_camp_lejeune</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-19.png" width="672" /></p>
<pre><code>## 
## $mcb_camp_pendleton</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-20.png" width="672" /></p>
<pre><code>## 
## $mcb_quantico</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-21.png" width="672" /></p>
<pre><code>## 
## $mcrd_beaufort_parris_island</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-22.png" width="672" /></p>
<pre><code>## 
## $mcrd_san_diego</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-23.png" width="672" /></p>
<pre><code>## 
## $ntc_and_fort_irwin</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-24.png" width="672" /></p>
<pre><code>## 
## $twentynine_palms_main_base</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="climatology_files/figure-html/plot_climatologies_map-25.png" width="672" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
